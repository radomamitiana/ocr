2025-08-19 14:24:21 | INFO     | src.ocr.ocr_engine:_validate_tesseract:55 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:24:21 | INFO     | src.main:lifespan:23 - Démarrage de l'application OCR Factures
2025-08-19 14:24:21 | INFO     | src.main:lifespan:24 - Version: 1.0.0
2025-08-19 14:24:21 | INFO     | src.main:lifespan:25 - Mode debug: False
2025-08-19 14:24:35 | ERROR    | src.main:general_exception_handler:105 - Erreur non gérée: name 'time' is not defined
2025-08-19 14:25:16 | INFO     | src.main:lifespan:30 - Arrêt de l'application OCR Factures
2025-08-19 14:25:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:55 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:25:17 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 14:25:17 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 14:25:17 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 14:25:39 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 14:25:39 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 14:45:12 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 14:45:12 | ERROR    | src.main:validation_exception_handler:63 - Erreur de validation: [{'type': 'missing', 'loc': ('body', 'file'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-08-19 14:45:12 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 0.01s
2025-08-19 14:45:22 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 14:45:22 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 14:45:22 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmprqz2rg2i.pdf
2025-08-19 14:45:22 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmprqz2rg2i.pdf
2025-08-19 14:45:22 | ERROR    | src.processors.pdf_processor:process:70 - Erreur lors de la conversion PDF: Unable to get page count. Is poppler installed and in PATH?
2025-08-19 14:45:22 | ERROR    | src.preprocessing.enhanced_image_processor:process_file:162 - Erreur lors du traitement du fichier: Impossible de convertir le PDF: Unable to get page count. Is poppler installed and in PATH?
2025-08-19 14:45:22 | ERROR    | src.api.routes:process_invoice:147 - Erreur interne: Impossible de traiter le fichier: Impossible de convertir le PDF: Unable to get page count. Is poppler installed and in PATH?
2025-08-19 14:45:22 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': 'Impossible de traiter le fichier: Impossible de convertir le PDF: Unable to get page count. Is poppler installed and in PATH?'}}
2025-08-19 14:45:22 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 0.02s
2025-08-19 14:49:17 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 14:49:19 | INFO     | src.ocr.ocr_engine:_validate_tesseract:55 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:49:19 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 14:49:19 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 14:49:19 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 14:49:35 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 14:49:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 14:49:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:49:37 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 14:49:37 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 14:49:37 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 14:49:42 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /usr/bin/tesseract
2025-08-19 14:49:42 | ERROR    | src.ocr.ocr_engine:_validate_tesseract:61 - Chemin tesseract utilisé: /usr/bin/tesseract
2025-08-19 14:50:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 14:50:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:50:17 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 14:50:17 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 14:50:17 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 14:50:17 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 14:50:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 14:50:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:50:31 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 14:50:31 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 14:50:31 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 14:51:09 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 14:51:09 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 14:51:11 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 14:51:11 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 14:51:11 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp01o2czj2.pdf
2025-08-19 14:51:11 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp01o2czj2.pdf
2025-08-19 14:51:12 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 14:51:12 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 14:51:12 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 14:51:12 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 14:51:12 | ERROR    | src.ocr.ocr_engine:extract_text:121 - Erreur lors de l'extraction OCR: No closing quotation
2025-08-19 14:51:12 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction OCR: No closing quotation
2025-08-19 14:51:12 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction OCR: No closing quotation"}}
2025-08-19 14:51:12 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 1.03s
2025-08-19 14:52:51 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/health
2025-08-19 14:52:51 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 404: Not Found
2025-08-19 14:52:51 | INFO     | src.main:log_requests:131 - Réponse: 404 - Temps de traitement: 0.00s
2025-08-19 14:53:00 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 14:53:00 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 14:53:34 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 14:53:34 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 14:53:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpbrgmvzld.pdf
2025-08-19 14:53:34 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpbrgmvzld.pdf
2025-08-19 14:53:34 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 14:53:34 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 14:53:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 14:53:34 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 14:53:34 | ERROR    | src.ocr.ocr_engine:extract_text:121 - Erreur lors de l'extraction OCR: No closing quotation
2025-08-19 14:53:34 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction OCR: No closing quotation
2025-08-19 14:53:34 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction OCR: No closing quotation"}}
2025-08-19 14:53:34 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 0.84s
2025-08-19 14:53:46 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 14:53:46 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 14:55:01 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 14:55:01 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 14:55:16 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 14:55:16 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 14:55:16 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpuuqri0fg.pdf
2025-08-19 14:55:16 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpuuqri0fg.pdf
2025-08-19 14:55:16 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 14:55:16 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 14:55:16 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 14:55:16 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 14:55:16 | ERROR    | src.ocr.ocr_engine:extract_text:121 - Erreur lors de l'extraction OCR: No closing quotation
2025-08-19 14:55:16 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction OCR: No closing quotation
2025-08-19 14:55:16 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction OCR: No closing quotation"}}
2025-08-19 14:55:16 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 0.80s
2025-08-19 14:58:51 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 14:58:51 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:58:51 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 14:58:51 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 14:58:51 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 14:59:05 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 14:59:05 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 14:59:05 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpv4939qvc.pdf
2025-08-19 14:59:05 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpv4939qvc.pdf
2025-08-19 14:59:05 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 14:59:05 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 14:59:06 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 14:59:06 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 14:59:06 | ERROR    | src.ocr.ocr_engine:extract_text:121 - Erreur lors de l'extraction OCR: No closing quotation
2025-08-19 14:59:06 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction OCR: No closing quotation
2025-08-19 14:59:06 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction OCR: No closing quotation"}}
2025-08-19 14:59:06 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 0.79s
2025-08-19 14:59:57 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 14:59:58 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 14:59:58 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 14:59:58 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 14:59:58 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 14:59:58 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 14:59:59 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:00:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:00:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:00:00 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:00:00 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:00:00 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:00:10 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:00:10 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:00:10 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpggkxba32.pdf
2025-08-19 15:00:10 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpggkxba32.pdf
2025-08-19 15:00:10 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:00:10 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:00:11 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:00:11 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:00:12 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:00:13 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:00:13 | ERROR    | src.extraction.data_extractor:extract_invoice_data:138 - Erreur lors de l'extraction: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:00:13 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction de données: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:00:13 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction de données: 1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required"}}
2025-08-19 15:00:13 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 2.71s
2025-08-19 15:00:34 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:00:34 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:00:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpz7wgihnk.pdf
2025-08-19 15:00:34 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpz7wgihnk.pdf
2025-08-19 15:00:34 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:00:34 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:00:35 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:00:35 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:00:36 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:00:37 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:00:37 | ERROR    | src.extraction.data_extractor:extract_invoice_data:138 - Erreur lors de l'extraction: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:00:37 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction de données: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:00:37 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction de données: 1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required"}}
2025-08-19 15:00:37 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 2.67s
2025-08-19 15:01:29 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:02:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:02:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:02:00 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:02:00 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:02:00 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:02:09 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:02:09 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:02:09 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpy01ulotu.pdf
2025-08-19 15:02:09 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpy01ulotu.pdf
2025-08-19 15:02:09 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:02:09 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:02:10 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:02:10 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:02:11 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:02:12 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:02:12 | ERROR    | src.extraction.data_extractor:extract_invoice_data:138 - Erreur lors de l'extraction: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:02:12 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction de données: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:02:12 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction de données: 1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required"}}
2025-08-19 15:02:12 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 2.62s
2025-08-19 15:02:28 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:02:29 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:02:29 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:02:29 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:02:29 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:02:29 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:02:29 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:02:30 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:02:30 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:02:30 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:02:30 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:02:30 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:02:41 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:02:41 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:02:41 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp93ujo29n.pdf
2025-08-19 15:02:41 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp93ujo29n.pdf
2025-08-19 15:02:42 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:02:42 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:02:42 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:02:42 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:02:44 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:02:44 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:02:44 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 15:02:44 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Champs requis manquants dans la facture
2025-08-19 15:02:44 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': 'Champs requis manquants dans la facture'}}
2025-08-19 15:02:44 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 2.67s
2025-08-19 15:03:06 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:03:07 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:03:07 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:03:07 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:03:07 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:03:07 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:03:08 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:03:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:03:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:03:09 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:03:09 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:03:09 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:03:19 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:03:19 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:03:19 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpc5jhb4p8.pdf
2025-08-19 15:03:19 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpc5jhb4p8.pdf
2025-08-19 15:03:19 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:03:19 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:03:20 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:03:20 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:03:21 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:03:22 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:03:22 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 15:03:22 | INFO     | src.api.routes:process_invoice:97 - Traitement terminé en 2.67s
2025-08-19 15:03:22 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 2.67s
2025-08-19 15:03:34 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:03:34 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:03:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8w8lk7u3.pdf
2025-08-19 15:03:34 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8w8lk7u3.pdf
2025-08-19 15:03:34 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:03:34 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:03:35 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:03:35 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:03:36 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:03:37 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:03:37 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 15:03:37 | INFO     | src.api.routes:process_invoice:97 - Traitement terminé en 2.74s
2025-08-19 15:03:37 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 2.74s
2025-08-19 15:07:35 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:07:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:07:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:07:37 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:07:37 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:07:37 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:07:57 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:07:58 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:07:58 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:07:58 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:07:58 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:07:58 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:08:16 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:08:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:08:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:08:17 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:08:17 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:08:17 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:08:43 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:08:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:08:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:08:44 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:08:44 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:08:44 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:09:05 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:09:07 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:09:07 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:09:07 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:09:07 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:09:07 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:09:18 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:09:18 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:09:18 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8u00dypf.pdf
2025-08-19 15:09:18 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8u00dypf.pdf
2025-08-19 15:09:18 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:09:18 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:09:18 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:09:18 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:09:20 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:09:21 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:09:21 | ERROR    | src.extraction.data_extractor:extract_invoice_data:138 - Erreur lors de l'extraction: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:09:21 | ERROR    | src.api.routes:process_invoice:135 - Erreur de traitement: Échec de l'extraction de données: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 15:09:21 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 422: {'status': 'error', 'error_code': 'PROCESSING_ERROR', 'message': "Impossible d'extraire les données de la facture", 'details': {'error': "Échec de l'extraction de données: 2 validation errors for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required\ndue_date\n  Input should be None [type=none_required, input_value=datetime.date(2025, 7, 1), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required"}}
2025-08-19 15:09:21 | INFO     | src.main:log_requests:131 - Réponse: 422 - Temps de traitement: 2.88s
2025-08-19 15:09:44 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:09:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:09:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:09:45 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:09:45 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:09:45 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:09:46 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:09:47 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:09:47 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:09:47 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:09:47 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:09:47 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:09:58 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:09:58 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:09:58 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp422z34uz.pdf
2025-08-19 15:09:58 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp422z34uz.pdf
2025-08-19 15:09:58 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:09:58 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:09:58 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:09:58 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:10:00 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:10:00 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:10:00 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 15:10:00 | INFO     | src.api.routes:process_invoice:97 - Traitement terminé en 2.65s
2025-08-19 15:10:00 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 2.65s
2025-08-19 15:10:34 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 15:10:34 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 15:10:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpq_f78dul.pdf
2025-08-19 15:10:34 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpq_f78dul.pdf
2025-08-19 15:10:34 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 15:10:34 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 15:10:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 15:10:34 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 15:10:36 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 15:10:36 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 15:10:36 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 15:10:36 | INFO     | src.api.routes:process_invoice:97 - Traitement terminé en 2.60s
2025-08-19 15:10:36 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 2.60s
2025-08-19 15:18:07 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:08 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:08 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:08 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:08 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:08 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:18:11 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:12 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:12 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:12 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:18:14 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:16 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:16 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:16 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:16 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:16 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:18:16 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:18 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:18 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:18 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:18 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:18 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:18:38 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:39 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:39 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:39 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:39 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:39 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:18:40 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:40 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:40 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:40 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:18:42 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:43 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:43 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:43 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:18:52 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:18:53 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:18:53 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:18:53 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:18:53 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:18:53 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:19:13 | ERROR    | src.database.connection:test_connection:52 - Erreur de connexion à la base de données: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-19 15:20:53 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:20:54 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:20:54 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:20:54 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:20:54 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:20:54 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:21:01 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:21:02 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:21:02 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:21:02 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:21:02 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:21:02 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:21:05 | INFO     | src.database.connection:test_connection:52 - Connexion à la base de données réussie
2025-08-19 15:21:05 | INFO     | src.database.connection:analyze_database_schema:114 - Analyse de la table invoice
2025-08-19 15:21:05 | INFO     | src.database.connection:analyze_database_schema:114 - Analyse de la table invoice_goal
2025-08-19 15:21:05 | INFO     | src.database.connection:analyze_database_schema:114 - Analyse de la table company
2025-08-19 15:21:05 | INFO     | src.database.connection:analyze_database_schema:114 - Analyse de la table customer
2025-08-19 15:23:50 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:23:51 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:23:51 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:23:51 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:23:51 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:23:51 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:23:58 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:24:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:24:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:24:00 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:24:00 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:24:00 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:24:08 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:24:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:24:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:24:09 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:24:09 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:24:09 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:24:14 | INFO     | src.database.connection:test_connection:52 - Connexion à la base de données réussie
2025-08-19 15:24:33 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:24:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:24:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:24:34 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:24:34 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:24:34 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:31:01 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:31:02 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:31:02 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:31:02 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:31:02 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:31:02 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:31:06 | ERROR    | src.database.connection:test_connection:52 - Erreur de connexion à la base de données: (psycopg2.OperationalError) connection to server at "193.108.52.211", port 5432 failed: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-19 15:31:11 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:31:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:31:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:31:12 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:31:12 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:31:12 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:31:13 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:31:14 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:31:14 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:31:14 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:31:14 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:31:14 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:33:35 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:33:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:33:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:33:37 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:33:37 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:33:37 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:33:41 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:33:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:33:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:33:43 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:33:43 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:33:43 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:33:44 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:33:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:33:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:33:45 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:33:45 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:33:45 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:35:10 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:35:11 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:35:11 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:35:11 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:35:11 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:35:11 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:35:25 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:35:27 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:35:27 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:35:27 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:35:27 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:35:27 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:35:29 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:35:30 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:35:30 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:35:30 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:35:30 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:35:30 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:35:30 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:35:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:35:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:35:31 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:35:31 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:35:31 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:36:03 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:36:05 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:36:05 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:36:05 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:36:05 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:36:05 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:36:36 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:36:38 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:36:38 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:36:38 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:36:38 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:36:38 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:37:24 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:37:26 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:37:26 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:37:26 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:37:26 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:37:26 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:37:40 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:37:41 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:37:41 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:37:41 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:37:41 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:37:41 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:37:57 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:37:59 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:37:59 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:37:59 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:37:59 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:37:59 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:38:25 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:38:26 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:38:26 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:38:26 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:38:26 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:38:26 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:38:44 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:38:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:38:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:38:45 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:38:45 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:38:45 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:38:50 | INFO     | src.database.connection:test_connection:49 - Connexion à la base de données réussie
2025-08-19 15:39:00 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:39:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:39:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:39:01 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:39:01 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:39:01 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:39:08 | INFO     | src.database.connection:test_connection:49 - Connexion à la base de données réussie
2025-08-19 15:40:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:40:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:40:45 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:40:45 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:40:45 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:48:14 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:48:14 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:48:16 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:48:16 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:48:16 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:48:16 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:48:16 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:48:16 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:48:16 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:48:16 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:48:16 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:48:16 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:48:55 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:48:55 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:48:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:48:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:48:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:48:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:48:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:48:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:48:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:48:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:48:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:48:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:49:16 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:49:16 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:49:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:49:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:49:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:49:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:49:17 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:49:17 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:49:17 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:49:17 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:49:17 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:49:17 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:49:31 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:49:31 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:49:32 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:49:32 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:49:32 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:49:32 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:49:32 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:49:32 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:49:32 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:49:32 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:49:32 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:49:32 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:49:40 | INFO     | src.database.connection:test_connection:49 - Connexion à la base de données réussie
2025-08-19 15:52:45 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:52:45 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:52:46 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:52:46 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:52:46 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:52:46 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:52:46 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:52:46 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:52:46 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:52:46 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:52:46 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:52:46 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:52:47 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:52:47 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:52:48 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:52:48 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:52:48 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:52:48 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:52:48 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:52:48 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:52:48 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:52:48 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:52:48 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:52:48 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:55:35 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:55:35 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:55:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:55:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:55:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:55:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:55:36 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:55:36 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:55:36 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:55:36 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:55:36 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:55:36 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:55:36 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:55:36 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:55:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:55:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:55:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:55:37 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:55:37 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:55:37 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:55:37 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:55:37 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:55:37 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:55:37 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:55:54 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:55:54 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:55:56 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:55:56 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:55:56 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:55:56 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:55:56 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:55:56 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:55:56 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:55:56 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:55:56 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:55:56 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:56:10 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:56:10 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:56:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:56:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:56:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:56:12 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:56:12 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:56:12 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:56:12 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:56:12 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:56:12 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:56:12 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:56:23 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:56:23 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:56:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:56:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:56:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:56:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:56:25 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:56:25 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:56:25 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:56:25 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:56:25 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:56:25 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:56:56 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:56:56 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:56:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:56:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:56:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:56:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:56:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:56:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:56:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:56:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:56:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:56:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:06 | INFO     | src.database.connection:test_connection:49 - Connexion à la base de données réussie
2025-08-19 15:57:23 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:23 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:25 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:25 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:25 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:25 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:25 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:25 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:25 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:41 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:41 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:42 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:42 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:42 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:42 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:42 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:42 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:42 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:42 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:42 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:42 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:51 | INFO     | src.database.connection:test_connection:49 - Connexion à la base de données réussie
2025-08-19 15:57:55 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:55 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:57 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:57 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:57:58 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:58 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:58 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:58 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:58 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:57:58 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:57:59 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:57:59 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:57:59 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:57:59 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:59:21 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:59:21 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 15:59:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:59:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 15:59:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:59:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 15:59:22 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:59:22 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 15:59:22 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:59:22 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 15:59:22 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 15:59:22 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:00:32 | INFO     | src.database.connection:test_connection:49 - Connexion à la base de données réussie
2025-08-19 16:00:46 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8001/api/v1/process-invoice
2025-08-19 16:00:46 | INFO     | src.api.routes:process_invoice:55 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:00:46 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp3_61bsdb.pdf
2025-08-19 16:00:46 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp3_61bsdb.pdf
2025-08-19 16:00:47 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:00:47 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:00:47 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:00:47 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:00:49 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:00:50 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:00:50 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:00:50 | INFO     | src.api.routes:process_invoice:97 - Traitement terminé en 3.91s
2025-08-19 16:00:50 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.93s
2025-08-19 16:00:56 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:00:56 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:00:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:00:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:00:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:00:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:00:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:00:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:00:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:00:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:00:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:00:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:02:21 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:02:21 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:02:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:02:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:02:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:02:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:02:23 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:02:23 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:02:23 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:02:23 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:02:23 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:02:23 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:03:35 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:03:35 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:03:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:03:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:03:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:03:36 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:03:36 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:03:36 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:03:36 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:03:36 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:03:36 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:03:36 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:03:59 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:03:59 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:04:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:04:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:04:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:04:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:04:01 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:04:01 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:04:01 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:04:01 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:04:01 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:04:01 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:04:09 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:04:09 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:04:11 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:04:11 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:04:11 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:04:11 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:04:11 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:04:11 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:04:11 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:04:11 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:04:11 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:04:11 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:04:44 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8001/api/v1/process-invoice
2025-08-19 16:04:44 | INFO     | src.api.routes:process_invoice:57 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 16:04:44 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpfjy7wvx9.pdf
2025-08-19 16:04:44 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpfjy7wvx9.pdf
2025-08-19 16:04:44 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:04:44 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:04:45 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:04:45 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:04:47 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 16:04:48 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:04:48 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:04:48 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:04:48 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, nr = .
{ KI VILLE DE 2 SITSE Reçu le: N° Facture 1688218
INYON..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.40, 0.000, 0.50, 0.50, null, 2025-08-19 16:04:48.817634).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': 'nr = .\n{ KI VILLE DE 2 SITSE Reçu le: N° Facture 1688218\nINYON | S [ S Date facture 14.02.2025 .\nid. Î pl FEV 2025 Echéance paiement 31.03.2025\n= ... (1853 characters truncated) ... i n .\n| CRETE ER HE Chemin de Balessert 5\n; ounex\nMonnaie Montant Monnaie Montant\nCHF 12671.55 CHF 12671.55\nPoint de dépôt |\nE |\n99-7 v 14 275', 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:04:48.772436", "confidence_score": 0.4, "processi ... (650 characters truncated) ... t": true, "data_quality_score": 0.5}}, "confidence_score": 0.4, "processing_time": 0.0, "validation_score": 0.5, "filename": "20250304163709949.pdf"}', 'confidence_score': 0.4, 'processing_time': 0.0, 'validation_score': 0.5, 'data_quality_score': 0.5}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:04:48 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:04:48 | INFO     | src.api.routes:process_invoice:100 - Traitement terminé en 4.38s
2025-08-19 16:04:48 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.39s
2025-08-19 16:06:30 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:30 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:31 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:31 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:31 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:06:31 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:31 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:31 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:06:32 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:32 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:34 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:34 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:34 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:06:34 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:34 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:34 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:06:42 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:42 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:43 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:43 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:43 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:06:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:43 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:43 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:43 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:06:46 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:46 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:06:47 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:47 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:47 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:47 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:47 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:06:47 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:06:47 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:06:47 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:06:47 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:06:47 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:15 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:15 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:17 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:17 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:17 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:17 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:17 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:17 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:17 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:17 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:17 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:18 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:19 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:19 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:19 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:19 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:19 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:19 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:19 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:19 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:19 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:29 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:29 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:31 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:31 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:31 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:31 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:31 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:31 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:38 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:38 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:07:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:07:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:40 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:40 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:40 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:07:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:07:40 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:07:40 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:07:40 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:08:43 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:08:43 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:08:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:08:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:08:44 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:08:44 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:08:44 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:08:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:08:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:08:44 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:08:44 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:08:44 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:09:01 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:09:01 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 16:09:01 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpre2paibo.pdf
2025-08-19 16:09:01 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpre2paibo.pdf
2025-08-19 16:09:01 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:09:01 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:09:01 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:09:01 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:09:03 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 16:09:03 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:09:03 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:09:03 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:09:03 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:09:03 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, SMART(OMPEL
SMARTCOMPIL PRAGUE DATE
7 rond-point de Stockholm FA..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.75, 0.75, null, 2025-08-19 16:09:03.822411).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "SMART(OMPEL\nSMARTCOMPIL PRAGUE DATE\n7 rond-point de Stockholm FAC-SC-202500612 01/07/2025\n78990 ELANCOURT\ncontact@smartcompil.fr PERIODE |  juin2 ... (937 characters truncated) ... 91023510000021 / TVA : FR15910235100 / RCS Versailles B 910235100\nIBAN : FR76 3000 3022 0500 0204 6390 036\nNous vous remercions de votre confiance.", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:09:03.789524", "confidence_score": 0.6, "processi ... (840 characters truncated) ...  0.75}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.75, "filename": "FAC-SC-202500612 R\\u00e9f N\\u00b0 25-06-2194.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.75, 'data_quality_score': 0.75}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:09:03 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:09:03 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:30 - Création de la facture en base de données
2025-08-19 16:09:03 | ERROR    | src.services.invoice_service:_insert_invoice_to_db:206 - Erreur lors de l'insertion en base: (psycopg2.errors.ForeignKeyViolation) insert or update on table "invoice" violates foreign key constraint "invoice_company_erp_code_fkey"
DETAIL:  Key (company_erp_code)=(SITSE) is not present in table "company".

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': '65b231ae-64c9-450a-a1d2-f3d90ce8f82c', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': 'SITSE', 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 3, 824312), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:09:03 | ERROR    | src.services.invoice_service:create_invoice_from_extracted_data:93 - Erreur lors de la création de la facture: (psycopg2.errors.ForeignKeyViolation) insert or update on table "invoice" violates foreign key constraint "invoice_company_erp_code_fkey"
DETAIL:  Key (company_erp_code)=(SITSE) is not present in table "company".

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': '65b231ae-64c9-450a-a1d2-f3d90ce8f82c', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': 'SITSE', 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 3, 824312), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:09:03 | ERROR    | src.api.routes:process_invoice:159 - Erreur interne: (psycopg2.errors.ForeignKeyViolation) insert or update on table "invoice" violates foreign key constraint "invoice_company_erp_code_fkey"
DETAIL:  Key (company_erp_code)=(SITSE) is not present in table "company".

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': '65b231ae-64c9-450a-a1d2-f3d90ce8f82c', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': 'SITSE', 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 3, 824312), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:09:03 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '(psycopg2.errors.ForeignKeyViolation) insert or update on table "invoice" violates foreign key constraint "invoice_company_erp_code_fkey"\nDETAIL:  Key (company_erp_code)=(SITSE) is not present in table "company".\n\n[SQL: \n                INSERT INTO invoice (\n                    id, invoice_number, invoice_date, company_erp_code, supplier_name,\n                    excluding_taxes, vat, including_taxes, payment_state, currency_code,\n                    is_complete, is_draft, created_date, created_by\n                ) VALUES (\n                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,\n                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,\n                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s\n                )\n            ]\n[parameters: {\'id\': \'65b231ae-64c9-450a-a1d2-f3d90ce8f82c\', \'invoice_number\': \'SC-202500612\', \'invoice_date\': datetime.date(2025, 7, 1), \'company_erp_code\': \'SITSE\', \'supplier_name\': None, \'excluding_taxes\': 3000.0, \'vat\': 600.0, \'including_taxes\': 3600.0, \'payment_state\': \'DRAFT\', \'currency_code\': \'EUR\', \'is_complete\': False, \'is_draft\': True, \'created_date\': datetime.datetime(2025, 8, 19, 16, 9, 3, 824312), \'created_by\': \'ocr_system\'}]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)'}}
2025-08-19 16:09:03 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 2.71s
2025-08-19 16:09:20 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:09:20 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:09:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:09:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:09:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:09:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:09:22 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:09:22 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:09:22 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:09:22 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:09:22 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:09:22 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:09:26 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:09:26 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 16:09:26 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp6m_c9c53.pdf
2025-08-19 16:09:26 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp6m_c9c53.pdf
2025-08-19 16:09:26 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:09:26 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:09:27 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:09:27 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:09:28 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 16:09:29 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:09:29 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:09:29 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:09:29 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:09:29 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, SMART(OMPEL
SMARTCOMPIL PRAGUE DATE
7 rond-point de Stockholm FA..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.75, 0.75, null, 2025-08-19 16:09:29.498685).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "SMART(OMPEL\nSMARTCOMPIL PRAGUE DATE\n7 rond-point de Stockholm FAC-SC-202500612 01/07/2025\n78990 ELANCOURT\ncontact@smartcompil.fr PERIODE |  juin2 ... (937 characters truncated) ... 91023510000021 / TVA : FR15910235100 / RCS Versailles B 910235100\nIBAN : FR76 3000 3022 0500 0204 6390 036\nNous vous remercions de votre confiance.", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:09:29.468486", "confidence_score": 0.6, "processi ... (840 characters truncated) ...  0.75}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.75, "filename": "FAC-SC-202500612 R\\u00e9f N\\u00b0 25-06-2194.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.75, 'data_quality_score': 0.75}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:09:29 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:09:29 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:30 - Création de la facture en base de données
2025-08-19 16:09:29 | ERROR    | src.services.invoice_service:_find_or_create_company:148 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code 
                               ^

[SQL: 
                SELECT company_erp_code 
                FROM company 
                LIMIT 1
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 16:09:29 | ERROR    | src.services.invoice_service:_insert_invoice_to_db:217 - Erreur lors de l'insertion en base: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': 'fee8128b-ebbb-49e8-a1da-ee1e23c80e5b', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 29, 500903), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:09:29 | ERROR    | src.services.invoice_service:create_invoice_from_extracted_data:93 - Erreur lors de la création de la facture: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': 'fee8128b-ebbb-49e8-a1da-ee1e23c80e5b', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 29, 500903), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:09:29 | ERROR    | src.api.routes:process_invoice:159 - Erreur interne: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': 'fee8128b-ebbb-49e8-a1da-ee1e23c80e5b', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 29, 500903), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:09:29 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': "(psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block\n\n[SQL: \n                INSERT INTO invoice (\n                    id, invoice_number, invoice_date, company_erp_code, supplier_name,\n                    excluding_taxes, vat, including_taxes, payment_state, currency_code,\n                    is_complete, is_draft, created_date, created_by\n                ) VALUES (\n                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,\n                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,\n                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s\n                )\n            ]\n[parameters: {'id': 'fee8128b-ebbb-49e8-a1da-ee1e23c80e5b', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 29, 500903), 'created_by': 'ocr_system'}]\n(Background on this error at: https://sqlalche.me/e/20/2j85)"}}
2025-08-19 16:09:29 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 2.79s
2025-08-19 16:09:43 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:09:43 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:09:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:09:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:09:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:09:45 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:09:45 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:09:45 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:09:45 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:09:45 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:09:45 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:09:45 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:09:49 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:09:49 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 16:09:49 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu5mty81l.pdf
2025-08-19 16:09:49 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu5mty81l.pdf
2025-08-19 16:09:49 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:09:49 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:09:49 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:09:49 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:09:51 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 16:09:51 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:09:51 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:09:51 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:09:51 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:09:51 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, SMART(OMPEL
SMARTCOMPIL PRAGUE DATE
7 rond-point de Stockholm FA..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.75, 0.75, null, 2025-08-19 16:09:51.912859).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "SMART(OMPEL\nSMARTCOMPIL PRAGUE DATE\n7 rond-point de Stockholm FAC-SC-202500612 01/07/2025\n78990 ELANCOURT\ncontact@smartcompil.fr PERIODE |  juin2 ... (937 characters truncated) ... 91023510000021 / TVA : FR15910235100 / RCS Versailles B 910235100\nIBAN : FR76 3000 3022 0500 0204 6390 036\nNous vous remercions de votre confiance.", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:09:51.883902", "confidence_score": 0.6, "processi ... (840 characters truncated) ...  0.75}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.75, "filename": "FAC-SC-202500612 R\\u00e9f N\\u00b0 25-06-2194.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.75, 'data_quality_score': 0.75}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:09:51 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:09:51 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:33 - Création de la facture en base de données
2025-08-19 16:09:51 | ERROR    | src.services.invoice_service:_find_or_create_company:155 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code 
                               ^

[SQL: 
                SELECT company_erp_code 
                FROM company 
                LIMIT 1
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 16:09:51 | ERROR    | src.services.invoice_service:_insert_invoice_to_db:224 - Erreur lors de l'insertion en base: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': 'c048fcb1-990d-42d5-943c-9d87886c8aee', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 51, 914752), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:09:51 | ERROR    | src.services.invoice_service:create_invoice_from_extracted_data:96 - Erreur lors de la création de la facture: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': 'c048fcb1-990d-42d5-943c-9d87886c8aee', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 51, 914752), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:09:51 | ERROR    | src.api.routes:process_invoice:159 - Erreur interne: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': 'c048fcb1-990d-42d5-943c-9d87886c8aee', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 51, 914752), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:09:51 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': "(psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block\n\n[SQL: \n                INSERT INTO invoice (\n                    id, invoice_number, invoice_date, company_erp_code, supplier_name,\n                    excluding_taxes, vat, including_taxes, payment_state, currency_code,\n                    is_complete, is_draft, created_date, created_by\n                ) VALUES (\n                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,\n                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,\n                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s\n                )\n            ]\n[parameters: {'id': 'c048fcb1-990d-42d5-943c-9d87886c8aee', 'invoice_number': 'SC-202500612', 'invoice_date': datetime.date(2025, 7, 1), 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': 3000.0, 'vat': 600.0, 'including_taxes': 3600.0, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 9, 51, 914752), 'created_by': 'ocr_system'}]\n(Background on this error at: https://sqlalche.me/e/20/2j85)"}}
2025-08-19 16:09:51 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 2.72s
2025-08-19 16:09:56 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:09:56 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:10:04 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:10:04 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:10:04 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:10:04 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:10:04 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:10:58 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:10:58 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:10:58 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu_8n9ci7.pdf
2025-08-19 16:10:58 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu_8n9ci7.pdf
2025-08-19 16:10:59 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:10:59 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:10:59 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:10:59 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:11:01 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:11:02 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:11:02 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:11:02 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:11:02 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:11:02 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, / |
| SITSE Reçu le:
V4 N Votre numéro de client : 1 086 778 P..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.25, 0.25, null, 2025-08-19 16:11:02.47162).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "/ |\n| SITSE Reçu le:\nV4 N Votre numéro de client : 1 086 778 Page 1/4\nq N° de facture : 110 009 850 987\nROMANDE 13 FEV, 05 N° pt mesure: CH101110 ... (1480 characters truncated) ... \nChemin Ballessert 5 1 En tr arr Énengesl à ï\n1297 Founex ' (nr san bn]\nMonnale Montant Monnaie Montant\nCHF 1858.75 ! CHF 1858.75\nPoint de dépôt", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:11:02.444109", "confidence_score": 0.6, "processi ... (1486 characters truncated) ...  false, "data_quality_score": 0.25}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.25, "filename": "20250304163636929.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.25, 'data_quality_score': 0.25}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:11:02 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:11:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:33 - Création de la facture en base de données
2025-08-19 16:11:02 | ERROR    | src.services.invoice_service:_find_or_create_company:155 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code 
                               ^

[SQL: 
                SELECT company_erp_code 
                FROM company 
                LIMIT 1
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 16:11:02 | ERROR    | src.services.invoice_service:_insert_invoice_to_db:224 - Erreur lors de l'insertion en base: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': '5bfccdd9-2e91-4132-9b42-256ae28a9966', 'invoice_number': 'ture', 'invoice_date': None, 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': None, 'vat': 136.35, 'including_taxes': None, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 11, 2, 473810), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:11:02 | ERROR    | src.services.invoice_service:create_invoice_from_extracted_data:96 - Erreur lors de la création de la facture: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': '5bfccdd9-2e91-4132-9b42-256ae28a9966', 'invoice_number': 'ture', 'invoice_date': None, 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': None, 'vat': 136.35, 'including_taxes': None, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 11, 2, 473810), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:11:02 | ERROR    | src.api.routes:process_invoice:159 - Erreur interne: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                INSERT INTO invoice (
                    id, invoice_number, invoice_date, company_erp_code, supplier_name,
                    excluding_taxes, vat, including_taxes, payment_state, currency_code,
                    is_complete, is_draft, created_date, created_by
                ) VALUES (
                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,
                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,
                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s
                )
            ]
[parameters: {'id': '5bfccdd9-2e91-4132-9b42-256ae28a9966', 'invoice_number': 'ture', 'invoice_date': None, 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': None, 'vat': 136.35, 'including_taxes': None, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 11, 2, 473810), 'created_by': 'ocr_system'}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:11:02 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': "(psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block\n\n[SQL: \n                INSERT INTO invoice (\n                    id, invoice_number, invoice_date, company_erp_code, supplier_name,\n                    excluding_taxes, vat, including_taxes, payment_state, currency_code,\n                    is_complete, is_draft, created_date, created_by\n                ) VALUES (\n                    %(id)s, %(invoice_number)s, %(invoice_date)s, %(company_erp_code)s, %(supplier_name)s,\n                    %(excluding_taxes)s, %(vat)s, %(including_taxes)s, %(payment_state)s, %(currency_code)s,\n                    %(is_complete)s, %(is_draft)s, %(created_date)s, %(created_by)s\n                )\n            ]\n[parameters: {'id': '5bfccdd9-2e91-4132-9b42-256ae28a9966', 'invoice_number': 'ture', 'invoice_date': None, 'company_erp_code': None, 'supplier_name': None, 'excluding_taxes': None, 'vat': 136.35, 'including_taxes': None, 'payment_state': 'DRAFT', 'currency_code': 'EUR', 'is_complete': False, 'is_draft': True, 'created_date': datetime.datetime(2025, 8, 19, 16, 11, 2, 473810), 'created_by': 'ocr_system'}]\n(Background on this error at: https://sqlalche.me/e/20/2j85)"}}
2025-08-19 16:11:02 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 3.66s
2025-08-19 16:11:38 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:11:39 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:11:39 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:11:39 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:11:39 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:11:39 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:11:39 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:11:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:11:40 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:11:40 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:11:40 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:11:40 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:12:42 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:12:42 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:12:42 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp6xrr6wh7.pdf
2025-08-19 16:12:42 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp6xrr6wh7.pdf
2025-08-19 16:12:42 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:12:42 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:12:43 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:12:43 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:12:45 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:12:46 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:12:46 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:12:46 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:12:46 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:12:46 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, / |
| SITSE Reçu le:
V4 N Votre numéro de client : 1 086 778 P..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.25, 0.25, null, 2025-08-19 16:12:46.198509).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "/ |\n| SITSE Reçu le:\nV4 N Votre numéro de client : 1 086 778 Page 1/4\nq N° de facture : 110 009 850 987\nROMANDE 13 FEV, 05 N° pt mesure: CH101110 ... (1480 characters truncated) ... \nChemin Ballessert 5 1 En tr arr Énengesl à ï\n1297 Founex ' (nr san bn]\nMonnale Montant Monnaie Montant\nCHF 1858.75 ! CHF 1858.75\nPoint de dépôt", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:12:46.171424", "confidence_score": 0.6, "processi ... (1486 characters truncated) ...  false, "data_quality_score": 0.25}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.25, "filename": "20250304163636929.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.25, 'data_quality_score': 0.25}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:12:46 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:12:46 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:30 - Création du DTO Invoice à partir des données extraites
2025-08-19 16:12:46 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:72 - DTO Invoice créé avec succès - ID: 80fac76e-ab3c-4910-9d96-f70730804422
2025-08-19 16:12:46 | INFO     | src.api.routes:process_invoice:109 - Traitement terminé en 3.59s
2025-08-19 16:12:46 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.59s
2025-08-19 16:12:55 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:12:55 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: FAC-SC-202500612 Réf N° 25-06-2194.pdf
2025-08-19 16:12:55 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp7x1w4ufu.pdf
2025-08-19 16:12:55 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp7x1w4ufu.pdf
2025-08-19 16:12:55 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:12:55 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:12:55 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:12:55 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:12:57 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.90
2025-08-19 16:12:57 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:12:57 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:12:57 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:12:57 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:12:57 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, SMART(OMPEL
SMARTCOMPIL PRAGUE DATE
7 rond-point de Stockholm FA..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.75, 0.75, null, 2025-08-19 16:12:57.740104).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "SMART(OMPEL\nSMARTCOMPIL PRAGUE DATE\n7 rond-point de Stockholm FAC-SC-202500612 01/07/2025\n78990 ELANCOURT\ncontact@smartcompil.fr PERIODE |  juin2 ... (937 characters truncated) ... 91023510000021 / TVA : FR15910235100 / RCS Versailles B 910235100\nIBAN : FR76 3000 3022 0500 0204 6390 036\nNous vous remercions de votre confiance.", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:12:57.733567", "confidence_score": 0.6, "processi ... (840 characters truncated) ...  0.75}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.75, "filename": "FAC-SC-202500612 R\\u00e9f N\\u00b0 25-06-2194.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.75, 'data_quality_score': 0.75}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:12:57 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:12:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:30 - Création du DTO Invoice à partir des données extraites
2025-08-19 16:12:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:72 - DTO Invoice créé avec succès - ID: 2123483c-0c91-40ce-855e-0bd0b6fe0946
2025-08-19 16:12:57 | INFO     | src.api.routes:process_invoice:109 - Traitement terminé en 2.63s
2025-08-19 16:12:57 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 2.63s
2025-08-19 16:13:37 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:13:37 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:13:37 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphikvacyd.pdf
2025-08-19 16:13:37 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphikvacyd.pdf
2025-08-19 16:13:37 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:13:37 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:13:38 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:13:38 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:13:40 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:13:41 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:13:41 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:13:41 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:13:41 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:13:41 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, / |
| SITSE Reçu le:
V4 N Votre numéro de client : 1 086 778 P..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.25, 0.25, null, 2025-08-19 16:13:41.110505).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "/ |\n| SITSE Reçu le:\nV4 N Votre numéro de client : 1 086 778 Page 1/4\nq N° de facture : 110 009 850 987\nROMANDE 13 FEV, 05 N° pt mesure: CH101110 ... (1480 characters truncated) ... \nChemin Ballessert 5 1 En tr arr Énengesl à ï\n1297 Founex ' (nr san bn]\nMonnale Montant Monnaie Montant\nCHF 1858.75 ! CHF 1858.75\nPoint de dépôt", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:13:41.108772", "confidence_score": 0.6, "processi ... (1486 characters truncated) ...  false, "data_quality_score": 0.25}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.25, "filename": "20250304163636929.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.25, 'data_quality_score': 0.25}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:13:41 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:13:41 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:30 - Création du DTO Invoice à partir des données extraites
2025-08-19 16:13:41 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:72 - DTO Invoice créé avec succès - ID: 09dc3fbe-6b2d-49ed-aa61-3af2237c48ca
2025-08-19 16:13:41 | INFO     | src.api.routes:process_invoice:109 - Traitement terminé en 3.53s
2025-08-19 16:13:41 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.54s
2025-08-19 16:20:29 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:20:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:20:31 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:20:31 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:20:31 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:20:31 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:20:32 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:20:33 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:20:33 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:20:33 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:20:33 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:20:33 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:22:33 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:22:35 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:22:35 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:22:35 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:22:35 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:22:35 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:25:39 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:25:41 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:25:41 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:25:41 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:25:41 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:25:41 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:26:27 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:26:28 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:26:28 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:26:28 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:26:28 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:26:28 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:26:54 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:26:56 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:26:56 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:26:56 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:26:56 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:26:56 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:27:08 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:27:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:27:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:27:10 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:27:10 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:27:10 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:27:32 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:27:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:27:34 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:27:34 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:27:34 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:27:34 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:27:59 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:28:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:28:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:28:00 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:28:00 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:28:00 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:28:16 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:28:18 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:28:18 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:28:18 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:28:18 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:28:18 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:28:27 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:28:27 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:28:27 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpsl4qqvts.pdf
2025-08-19 16:28:27 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpsl4qqvts.pdf
2025-08-19 16:28:27 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:28:27 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:28:28 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:28:28 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:28:30 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:28:31 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:28:31 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:28:31 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:28:31 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:28:31 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, / |
| SITSE Reçu le:
V4 N Votre numéro de client : 1 086 778 P..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.25, 0.25, null, 2025-08-19 16:28:31.062387).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "/ |\n| SITSE Reçu le:\nV4 N Votre numéro de client : 1 086 778 Page 1/4\nq N° de facture : 110 009 850 987\nROMANDE 13 FEV, 05 N° pt mesure: CH101110 ... (1480 characters truncated) ... \nChemin Ballessert 5 1 En tr arr Énengesl à ï\n1297 Founex ' (nr san bn]\nMonnale Montant Monnaie Montant\nCHF 1858.75 ! CHF 1858.75\nPoint de dépôt", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:28:31.032605", "confidence_score": 0.6, "processi ... (1486 characters truncated) ...  false, "data_quality_score": 0.25}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.25, "filename": "20250304163636929.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.25, 'data_quality_score': 0.25}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:28:31 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:28:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 16:28:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 16:28:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 16:28:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 16:28:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:168 - Erreur lors de la recherche de société: 'str' object is not callable
2025-08-19 16:28:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:207 - Erreur lors de la recherche de fournisseur: 'str' object is not callable
2025-08-19 16:28:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:216 - Devise trouvée: CHF
2025-08-19 16:28:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:243 - total_ttc trouvé: 1858.75
2025-08-19 16:28:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 16:28:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: d6037376-1475-4242-b3a4-0ece1fd0853e
2025-08-19 16:28:31 | INFO     | src.api.routes:process_invoice:110 - Traitement terminé en 3.68s
2025-08-19 16:28:31 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.68s
2025-08-19 16:29:01 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:29:02 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:29:02 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:29:02 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:29:02 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:29:02 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:29:13 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:29:13 | INFO     | src.api.routes:process_invoice:59 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:29:13 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpwo_xkm12.pdf
2025-08-19 16:29:13 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpwo_xkm12.pdf
2025-08-19 16:29:13 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:29:13 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:29:14 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:29:14 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:29:16 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:29:17 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:44 - Début de l'extraction ML améliorée
2025-08-19 16:29:17 | INFO     | src.extraction.data_extractor:extract_invoice_data:97 - Début de l'extraction de données
2025-08-19 16:29:17 | INFO     | src.extraction.data_extractor:extract_invoice_data:134 - Extraction de données terminée
2025-08-19 16:29:17 | ERROR    | src.extraction.ml_enhanced_extractor:_enhance_amounts_with_history:204 - Erreur lors de l'amélioration des montants: 'str' object is not callable
2025-08-19 16:29:17 | ERROR    | src.extraction.ml_enhanced_extractor:_save_ml_training_data:427 - Erreur lors de la sauvegarde ML: (psycopg2.errors.NotNullViolation) null value in column "id" of relation "invoice_ml_data" violates not-null constraint
DETAIL:  Failing row contains (null, null, / |
| SITSE Reçu le:
V4 N Votre numéro de client : 1 086 778 P..., {"extracted_data": {"metadata": {"filename": "processed_invoice"..., 0.60, 0.000, 0.25, 0.25, null, 2025-08-19 16:29:17.062035).

[SQL: 
                INSERT INTO invoice_ml_data (raw_text, extracted_data, confidence_score, 
                                           processing_time, validation_score, data_quality_score)
                VALUES (%(raw_text)s, %(extracted_data)s, %(confidence_score)s, %(processing_time)s, 
                        %(validation_score)s, %(data_quality_score)s)
            ]
[parameters: {'raw_text': "/ |\n| SITSE Reçu le:\nV4 N Votre numéro de client : 1 086 778 Page 1/4\nq N° de facture : 110 009 850 987\nROMANDE 13 FEV, 05 N° pt mesure: CH101110 ... (1480 characters truncated) ... \nChemin Ballessert 5 1 En tr arr Énengesl à ï\n1297 Founex ' (nr san bn]\nMonnale Montant Monnaie Montant\nCHF 1858.75 ! CHF 1858.75\nPoint de dépôt", 'extracted_data': '{"extracted_data": {"metadata": {"filename": "processed_invoice", "processing_date": "2025-08-19 16:29:17.009436", "confidence_score": 0.6, "processi ... (1486 characters truncated) ...  false, "data_quality_score": 0.25}}, "confidence_score": 0.6, "processing_time": 0.0, "validation_score": 0.25, "filename": "20250304163636929.pdf"}', 'confidence_score': 0.6, 'processing_time': 0.0, 'validation_score': 0.25, 'data_quality_score': 0.25}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-19 16:29:17 | INFO     | src.extraction.ml_enhanced_extractor:extract_invoice_data_with_ml:61 - Extraction ML améliorée terminée
2025-08-19 16:29:17 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 16:29:17 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 16:29:17 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 16:29:17 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 16:29:17 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 16:29:17 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:29:17 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 16:29:17 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 16:29:17 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 16:29:17 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: dd1b49ae-49ef-4f0e-be5d-3e5b5b7be5bd
2025-08-19 16:29:17 | INFO     | src.api.routes:process_invoice:110 - Traitement terminé en 3.79s
2025-08-19 16:29:17 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.79s
2025-08-19 16:35:19 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:35:21 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:35:21 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:35:21 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:35:21 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:35:21 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:35:22 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:35:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:35:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:35:23 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:35:23 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:35:23 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:35:42 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:35:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:35:44 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:35:44 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:35:44 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:35:44 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:38:17 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:38:19 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:38:19 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:38:19 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:38:19 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:38:19 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:38:19 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:38:20 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:38:20 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:38:20 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:38:20 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:38:20 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:38:56 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:38:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:38:57 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:38:57 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:38:57 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:38:57 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:39:42 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:39:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:39:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:39:43 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:39:43 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:39:43 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:39:58 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:40:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:40:00 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:40:00 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:40:00 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:40:00 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:54:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:54:23 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:54:23 | ERROR    | src.extraction.llm_enhanced_extractor:_load_companies_from_db:85 - Erreur lors du chargement des sociétés: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name, compa...
                               ^

[SQL: 
                SELECT company_erp_code, company_name, company_address, company_rcs
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 16:54:23 | ERROR    | src.extraction.llm_enhanced_extractor:_load_suppliers_from_db:101 - Erreur lors du chargement des fournisseurs: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT social_reason, rcs, address, email, phone_number, contact_name
                FROM supplier 
                WHERE is_active = true AND social_reason IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 16:54:23 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 0 sociétés et 0 fournisseurs
2025-08-19 16:54:23 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:54:23 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:54:23 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:55:28 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:55:30 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:55:30 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:55:30 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 16:55:30 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:55:30 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:55:30 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:55:50 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:55:52 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:55:52 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:55:52 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 16:55:52 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:55:52 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:55:52 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:56:05 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:56:06 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:56:06 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:56:06 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 16:56:06 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:56:06 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:56:06 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:56:20 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 16:56:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 16:56:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 16:56:22 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 16:56:22 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 16:56:22 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 16:56:22 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 16:56:33 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 16:56:33 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 16:56:33 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:56:33 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:56:33 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpqsq_t4k4.pdf
2025-08-19 16:56:33 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpqsq_t4k4.pdf
2025-08-19 16:56:33 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:56:33 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:56:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:56:34 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:56:36 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:56:37 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 16:56:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 16:56:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 16:56:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 16:56:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 16:56:37 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 16:56:37 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 16:56:37 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 17), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 3, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:37 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 16:56:37 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:37 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 16:56:37 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 4.03s
2025-08-19 16:56:37 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:56:37 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 16:56:37 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmporp7tcre.pdf
2025-08-19 16:56:37 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmporp7tcre.pdf
2025-08-19 16:56:37 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:56:37 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:56:38 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:56:38 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:56:40 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 16:56:41 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 16:56:41 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 16:56:41 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 16:56:41 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 16:56:41 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 16:56:41 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 1, 31), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 3, 31), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:41 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 16:56:41 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:41 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 16:56:41 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 4.66s
2025-08-19 16:56:41 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:56:41 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 16:56:41 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp34z7_870.pdf
2025-08-19 16:56:41 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp34z7_870.pdf
2025-08-19 16:56:42 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:56:42 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:56:42 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:56:42 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:56:44 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 16:56:44 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 16:56:44 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 16:56:44 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 16:56:44 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 16:56:44 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 16:56:44 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 16:56:44 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 10), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 11), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:44 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 16:56:44 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:44 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 16:56:44 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 3.08s
2025-08-19 16:56:44 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:56:44 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 16:56:44 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpzw0co2o7.pdf
2025-08-19 16:56:44 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpzw0co2o7.pdf
2025-08-19 16:56:45 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:56:45 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:56:45 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:56:45 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:56:48 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 16:56:49 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 16:56:49 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 16:56:49 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 16:56:49 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 16:56:49 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 16:56:49 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 16:56:49 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2024, 4, 26), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:49 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 16:56:49 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:56:49 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 16:56:49 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 4.17s
2025-08-19 16:57:33 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 16:57:33 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 16:57:36 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 16:57:36 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 16:57:36 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp3pugykev.pdf
2025-08-19 16:57:36 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp3pugykev.pdf
2025-08-19 16:57:37 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 16:57:37 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 16:57:37 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 16:57:37 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 16:57:39 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 16:57:40 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 16:57:40 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 16:57:40 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 16:57:40 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 16:57:40 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 16:57:40 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 16:57:40 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 16:57:40 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 17), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 3, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:57:40 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 16:57:40 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 16:57:40 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 16:57:40 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 3.62s
2025-08-19 17:00:00 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:00:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:00:01 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:00:01 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:00:01 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:00:01 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:00:01 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:00:12 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:00:12 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:00:12 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:00:12 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:00:12 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpuu2tf9rz.pdf
2025-08-19 17:00:12 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpuu2tf9rz.pdf
2025-08-19 17:00:13 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:00:13 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:00:13 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:00:13 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:00:15 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:00:16 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:00:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:00:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:00:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:00:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:00:16 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:00:16 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:00:16 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 1 validation error for Supplier
address
  Input should be a valid dictionary or instance of Address [type=model_type, input_value='Rue de Lausanne 53, 1110 Morges, Suisse', input_type=str]
    For further information visit https://errors.pydantic.dev/2.5/v/model_type
2025-08-19 17:00:16 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 17:00:16 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:00:16 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 17:00:16 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 3.66s
2025-08-19 17:00:16 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:00:16 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:00:16 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp_xq5f_h8.pdf
2025-08-19 17:00:16 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp_xq5f_h8.pdf
2025-08-19 17:00:16 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:00:16 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:00:17 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:00:17 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:00:19 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:00:21 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:00:21 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:00:21 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:00:21 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:00:21 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:00:21 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 1 validation error for Supplier
address
  Input should be a valid dictionary or instance of Address [type=model_type, input_value='Services Industriels de ...au 3, 1260 Nyon, Suisse', input_type=str]
    For further information visit https://errors.pydantic.dev/2.5/v/model_type
2025-08-19 17:00:21 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 17:00:21 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:00:21 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 17:00:21 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 4.56s
2025-08-19 17:00:21 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:00:21 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:00:21 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphcls3i0j.pdf
2025-08-19 17:00:21 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphcls3i0j.pdf
2025-08-19 17:00:21 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:00:21 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:00:22 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:00:22 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:00:23 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:00:24 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:00:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:00:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:00:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:00:24 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:00:24 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:00:24 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 1 validation error for Supplier
address
  Input should be a valid dictionary or instance of Address [type=model_type, input_value='Rue de la Gare 12, 1260 Nyon, Suisse', input_type=str]
    For further information visit https://errors.pydantic.dev/2.5/v/model_type
2025-08-19 17:00:24 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 17:00:24 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:00:24 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 17:00:24 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 3.09s
2025-08-19 17:00:24 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:00:24 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:00:24 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpav97ema9.pdf
2025-08-19 17:00:24 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpav97ema9.pdf
2025-08-19 17:00:24 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:00:24 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:00:25 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:00:25 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:00:27 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:00:28 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:00:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:00:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:00:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:00:28 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:00:28 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:00:28 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 1 validation error for Supplier
address
  Input should be a valid dictionary or instance of Address [type=model_type, input_value='Zone Industrielle, Chemi...z 15, 1260 Nyon, Suisse', input_type=str]
    For further information visit https://errors.pydantic.dev/2.5/v/model_type
2025-08-19 17:00:28 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:525 - Utilisation de l'extraction de fallback
2025-08-19 17:00:28 | ERROR    | src.api.routes:process_invoice:162 - Erreur interne: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:00:28 | ERROR    | src.main:http_exception_handler:78 - Erreur HTTP 500: {'status': 'error', 'error_code': 'INTERNAL_ERROR', 'message': 'Erreur interne du serveur', 'details': {'error': '1 validation error for Invoice\ndate\n  Input should be None [type=none_required, input_value=datetime.date(2025, 8, 19), input_type=date]\n    For further information visit https://errors.pydantic.dev/2.5/v/none_required'}}
2025-08-19 17:00:28 | INFO     | src.main:log_requests:131 - Réponse: 500 - Temps de traitement: 4.11s
2025-08-19 17:00:50 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:00:52 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:00:52 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:00:52 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:00:52 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:00:52 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:00:52 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:01:08 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:01:10 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:01:10 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:01:10 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:01:10 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:01:10 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:01:10 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:01:21 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:01:21 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:01:21 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:01:21 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:01:21 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpx77_ojqf.pdf
2025-08-19 17:01:21 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpx77_ojqf.pdf
2025-08-19 17:01:22 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:01:22 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:01:22 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:01:22 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:01:24 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:01:25 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:01:25 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:01:25 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:01:25 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:01:25 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:01:25 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:01:25 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:01:25 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:01:25 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:01:25 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:01:25 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 495c32f5-7bec-492c-be82-4b7cd7220b15
2025-08-19 17:01:25 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.87s
2025-08-19 17:01:25 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.88s
2025-08-19 17:01:25 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:01:25 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:01:25 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpni0v5npj.pdf
2025-08-19 17:01:25 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpni0v5npj.pdf
2025-08-19 17:01:26 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:01:26 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:01:26 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:01:26 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:01:29 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:01:30 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:01:30 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:01:30 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:01:30 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:01:30 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:01:30 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:01:30 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:01:30 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:01:30 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:01:30 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:01:30 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:01:30 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:01:30 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:01:30 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:01:30 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:01:30 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:01:30 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 9a7ecfdc-fb4c-4f6c-9ee9-39bfe64851dd
2025-08-19 17:01:30 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.77s
2025-08-19 17:01:30 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.78s
2025-08-19 17:01:30 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:01:30 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:01:30 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpei35ej7r.pdf
2025-08-19 17:01:30 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpei35ej7r.pdf
2025-08-19 17:01:30 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:01:30 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:01:31 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:01:31 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:01:32 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:01:33 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:01:33 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:01:33 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:01:33 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:01:33 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:01:33 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:01:33 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:01:33 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:01:33 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:01:33 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:01:33 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: afb4834f-ef2d-4019-9815-a87af1acea55
2025-08-19 17:01:33 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.07s
2025-08-19 17:01:33 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.10s
2025-08-19 17:01:33 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:01:33 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:01:33 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpfsvu24b2.pdf
2025-08-19 17:01:33 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpfsvu24b2.pdf
2025-08-19 17:01:33 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:01:33 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:01:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:01:34 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:01:36 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:01:37 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:01:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:01:37 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:01:37 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:01:37 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:01:37 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:01:37 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:01:37 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:01:37 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:01:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 950a3d25-9a36-4e43-9aa3-97f466596d02
2025-08-19 17:01:37 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.11s
2025-08-19 17:01:37 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.12s
2025-08-19 17:02:26 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:02:28 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:02:28 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:02:28 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:02:28 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:02:28 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:02:28 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:02:41 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:02:41 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:02:41 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:02:41 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:02:41 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpsairlujl.pdf
2025-08-19 17:02:41 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpsairlujl.pdf
2025-08-19 17:02:42 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:02:42 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:02:42 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:02:42 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:02:44 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:02:45 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:02:45 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:02:45 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:02:45 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:02:45 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:02:45 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:02:45 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:02:45 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:02:45 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:02:45 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:02:45 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 71fa4e71-a363-4f83-9ec8-86644d4fbb7d
2025-08-19 17:02:45 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.75s
2025-08-19 17:02:45 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.76s
2025-08-19 17:02:45 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:02:45 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:02:45 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmppvg68rp2.pdf
2025-08-19 17:02:45 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmppvg68rp2.pdf
2025-08-19 17:02:45 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:02:46 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:02:46 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:02:46 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:02:48 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:02:50 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:02:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:02:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:02:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:02:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:02:50 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:02:50 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:02:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:02:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:02:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:02:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:02:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:02:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:02:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:02:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:02:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:02:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: bce40594-93c6-486b-b975-abf9ce21b753
2025-08-19 17:02:50 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.52s
2025-08-19 17:02:50 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.53s
2025-08-19 17:02:50 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:02:50 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:02:50 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmppb5_hdw8.pdf
2025-08-19 17:02:50 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmppb5_hdw8.pdf
2025-08-19 17:02:50 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:02:50 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:02:51 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:02:51 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:02:52 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:02:53 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:02:53 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:02:53 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:02:53 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:02:53 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:02:53 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:02:53 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:02:53 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:02:53 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:02:53 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:02:53 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 345ceaf5-73f6-4748-bafd-2c42eb6df131
2025-08-19 17:02:53 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.09s
2025-08-19 17:02:53 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.11s
2025-08-19 17:02:53 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:02:53 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:02:53 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu6b4vzsk.pdf
2025-08-19 17:02:53 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu6b4vzsk.pdf
2025-08-19 17:02:53 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:02:53 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:02:54 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:02:54 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:02:56 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:02:57 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:02:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:02:57 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:02:57 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:02:57 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:02:57 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:02:57 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:02:57 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:02:57 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:02:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: cf13dae4-3bf1-414f-a983-71b2c5832e7f
2025-08-19 17:02:57 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.12s
2025-08-19 17:02:57 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.13s
2025-08-19 17:03:45 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:03:45 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:03:45 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp7wpug6zj.pdf
2025-08-19 17:03:45 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp7wpug6zj.pdf
2025-08-19 17:03:46 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:03:46 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:03:46 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:03:46 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:03:48 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:528 - InvoiceData complet construit sans valeurs null
2025-08-19 17:03:49 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:03:49 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:03:49 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:03:49 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:03:49 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:03:49 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:03:49 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:03:49 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:03:49 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:03:49 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:03:49 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: cfd7a7cc-875e-4c61-b37b-2fb8c5b36d65
2025-08-19 17:03:49 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.64s
2025-08-19 17:03:49 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.67s
2025-08-19 17:08:09 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:08:10 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:08:10 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:08:11 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:08:11 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:08:11 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:08:11 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:08:28 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:08:29 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:08:29 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:08:29 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:08:29 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:08:29 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:08:29 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:08:38 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:08:38 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:08:38 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:08:38 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:08:38 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpncleillg.pdf
2025-08-19 17:08:38 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpncleillg.pdf
2025-08-19 17:08:38 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:08:38 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:08:39 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:08:39 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:08:41 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:08:42 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:08:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:08:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:08:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:08:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:08:42 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:08:42 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:08:42 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 17), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 3, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:08:42 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:08:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:08:42 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:08:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:08:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:08:42 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:08:42 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:08:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:08:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:08:42 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:08:42 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819170842
2025-08-19 17:08:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: bd3b2c9a-3e3d-47c5-95f5-a3ec1b1dd6f6
2025-08-19 17:08:42 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.72s
2025-08-19 17:08:42 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.74s
2025-08-19 17:08:42 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:08:42 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:08:42 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpqfm1e3du.pdf
2025-08-19 17:08:42 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpqfm1e3du.pdf
2025-08-19 17:08:42 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:08:42 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:08:43 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:08:43 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:08:45 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:08:46 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:08:46 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:08:46 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:08:46 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:08:46 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:08:46 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 1, 31), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 3, 31), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:08:46 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:08:46 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:08:46 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:08:46 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:08:46 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:08:46 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:08:46 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:08:46 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:08:46 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:08:46 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:08:46 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819170846
2025-08-19 17:08:46 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: c075e7e2-ac85-4a9b-954a-663bfcb74693
2025-08-19 17:08:46 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.64s
2025-08-19 17:08:46 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.65s
2025-08-19 17:08:46 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:08:46 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:08:46 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpx8drq5th.pdf
2025-08-19 17:08:46 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpx8drq5th.pdf
2025-08-19 17:08:47 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:08:47 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:08:47 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:08:47 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:08:49 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:08:50 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:08:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:08:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:08:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:08:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:08:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:08:50 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 10), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 11), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:08:50 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:08:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:08:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:08:50 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:08:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:08:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:08:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:08:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:08:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:08:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:08:50 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819170850
2025-08-19 17:08:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: df6ddd9f-bd9b-41ca-80a2-e9c322393f25
2025-08-19 17:08:50 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.07s
2025-08-19 17:08:50 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.09s
2025-08-19 17:08:50 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:08:50 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:08:50 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpthbwsm1h.pdf
2025-08-19 17:08:50 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpthbwsm1h.pdf
2025-08-19 17:08:50 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:08:50 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:08:50 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:08:50 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:08:53 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:08:54 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:08:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:08:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:08:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:08:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:08:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:08:54 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2024, 4, 26), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:08:54 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:08:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:08:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:08:54 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:08:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:08:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:08:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:08:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:08:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:08:54 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819170854
2025-08-19 17:08:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: ee4938a6-800c-4969-a8d0-bea8ba41f9aa
2025-08-19 17:08:54 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.00s
2025-08-19 17:08:54 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.01s
2025-08-19 17:09:18 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:10:04 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:10:04 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:10:05 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:10:05 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:10:05 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:10:05 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:10:12 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:10:12 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:10:12 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:10:12 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:10:12 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp0gilb3qv.pdf
2025-08-19 17:10:12 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp0gilb3qv.pdf
2025-08-19 17:10:13 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:10:13 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:10:13 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:10:13 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:10:15 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:10:16 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:10:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:10:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:10:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:10:16 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:10:16 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:10:16 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:10:16 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 17), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 3, 19), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:10:16 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:10:16 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:10:16 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:10:16 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:10:16 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:10:16 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:10:16 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:10:16 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:10:16 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:10:16 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:10:16 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819171016
2025-08-19 17:10:16 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 72ef3e31-066d-4add-a02f-f42aa20d32c1
2025-08-19 17:10:16 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.85s
2025-08-19 17:10:16 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.86s
2025-08-19 17:10:16 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:10:16 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:10:16 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpe4u1c6f9.pdf
2025-08-19 17:10:16 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpe4u1c6f9.pdf
2025-08-19 17:10:16 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:10:17 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:10:17 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:10:17 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:10:20 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:10:21 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:10:21 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:10:21 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:10:21 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:10:21 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:10:21 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 1, 31), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 3, 31), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:10:21 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:10:21 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:10:21 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:10:21 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:10:21 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:10:21 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:10:21 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:10:21 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:10:21 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:10:21 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:10:21 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819171021
2025-08-19 17:10:21 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 922f314e-c5e7-401a-9af0-e0551f117877
2025-08-19 17:10:21 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.67s
2025-08-19 17:10:21 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.68s
2025-08-19 17:10:21 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:10:21 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:10:21 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8o_muxbu.pdf
2025-08-19 17:10:21 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8o_muxbu.pdf
2025-08-19 17:10:21 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:10:21 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:10:22 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:10:22 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:10:23 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:10:24 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:10:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:10:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:10:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:10:24 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:10:24 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:10:24 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 2 validation errors for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 10), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
due_date
  Input should be None [type=none_required, input_value=datetime.date(2025, 2, 11), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:10:24 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:10:24 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:10:24 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:10:24 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:10:24 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:10:24 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:10:24 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:10:24 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:10:24 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:10:24 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:10:24 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819171024
2025-08-19 17:10:24 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 218aef0e-010c-46ed-93e4-a626d368c6ae
2025-08-19 17:10:24 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 2.98s
2025-08-19 17:10:24 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.00s
2025-08-19 17:10:24 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:10:24 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:10:24 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpa42vqbq_.pdf
2025-08-19 17:10:24 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpa42vqbq_.pdf
2025-08-19 17:10:24 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:10:24 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:10:25 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:10:25 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:10:27 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:10:28 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:10:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:10:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:10:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:10:28 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:10:28 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:10:28 | ERROR    | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:68 - Erreur lors de l'extraction LLM: 1 validation error for Invoice
date
  Input should be None [type=none_required, input_value=datetime.date(2024, 4, 26), input_type=date]
    For further information visit https://errors.pydantic.dev/2.5/v/none_required
2025-08-19 17:10:28 | WARNING  | src.extraction.llm_enhanced_extractor:_fallback_extraction:533 - Utilisation de l'extraction de fallback
2025-08-19 17:10:28 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:10:28 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:10:28 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:10:28 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:10:28 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:10:28 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:10:28 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:10:28 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:10:28 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: FALLBACK-20250819171028
2025-08-19 17:10:28 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 7e5c6c86-8023-4fe8-94e9-aafb3a1a21ab
2025-08-19 17:10:28 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.13s
2025-08-19 17:10:28 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.15s
2025-08-19 17:11:42 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:11:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:11:43 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:11:43 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:11:43 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:11:43 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:11:43 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:11:52 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:11:52 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:11:52 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:11:52 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:11:52 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmps42cjvcv.pdf
2025-08-19 17:11:52 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmps42cjvcv.pdf
2025-08-19 17:11:52 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:11:52 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:11:53 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:11:53 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:11:55 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:11:56 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:11:56 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:11:56 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:11:56 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:11:56 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:11:56 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:11:56 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:11:56 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:11:56 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:11:56 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:11:56 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: defacture
2025-08-19 17:11:56 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:11:56 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: c56ce433-796a-454c-8b36-cf72d6265df6
2025-08-19 17:11:56 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.93s
2025-08-19 17:11:56 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.95s
2025-08-19 17:11:56 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:11:56 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:11:56 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpf68p4sw2.pdf
2025-08-19 17:11:56 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpf68p4sw2.pdf
2025-08-19 17:11:56 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:11:56 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:11:57 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:11:57 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:11:59 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:12:01 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:12:01 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:12:01 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:12:01 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:12:01 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:12:01 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:12:01 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:12:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:12:01 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:12:01 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:12:01 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:12:01 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:12:01 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:12:01 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:12:01 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:12:01 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:12:01 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: Facture1688218INYON
2025-08-19 17:12:01 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:12:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 2219e343-f328-4a0a-bb3c-011188ae9b5f
2025-08-19 17:12:01 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.66s
2025-08-19 17:12:01 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.67s
2025-08-19 17:12:01 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:12:01 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:12:01 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp03qo60gc.pdf
2025-08-19 17:12:01 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp03qo60gc.pdf
2025-08-19 17:12:01 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:12:01 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:12:01 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:12:01 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:12:03 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:12:04 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:12:04 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:12:04 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:12:04 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:12:04 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:12:04 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:12:04 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:12:04 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:12:04 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:12:04 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:12:04 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: client
2025-08-19 17:12:04 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:12:04 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 141b8851-7697-4c98-b1dc-c92f72b0f26e
2025-08-19 17:12:04 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 2.99s
2025-08-19 17:12:04 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.01s
2025-08-19 17:12:04 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:12:04 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:12:04 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpy8f02jil.pdf
2025-08-19 17:12:04 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpy8f02jil.pdf
2025-08-19 17:12:04 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:12:04 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:12:04 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:12:04 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:12:07 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:12:08 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:12:08 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:12:08 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:12:08 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:12:08 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:12:08 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:12:08 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:12:08 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:12:08 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:12:08 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: CHE-106
2025-08-19 17:12:08 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:12:08 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 529fdcc5-9225-4508-ac1e-73d10987082c
2025-08-19 17:12:08 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.07s
2025-08-19 17:12:08 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.08s
2025-08-19 17:14:07 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:14:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:14:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:14:09 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:14:09 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:14:09 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:14:09 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:14:20 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:14:20 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:14:20 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:14:20 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:14:20 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmps_b9qooe.pdf
2025-08-19 17:14:20 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmps_b9qooe.pdf
2025-08-19 17:14:20 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:14:20 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:14:21 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:14:21 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:14:23 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:14:24 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:14:24 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:14:24 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:14:24 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:14:24 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:14:24 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:14:24 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:14:24 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:14:24 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: defacture
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: defacture
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE Services Industriels de Terre-Sainte et Environs
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:323 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:325 - TVA LLM utilisée: 136.35
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:327 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:14:24 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 74e4dac3-7fdc-450b-85fd-f1883bb0379c
2025-08-19 17:14:24 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.57s
2025-08-19 17:14:24 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.58s
2025-08-19 17:14:24 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:14:24 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:14:24 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpro3o6xc6.pdf
2025-08-19 17:14:24 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpro3o6xc6.pdf
2025-08-19 17:14:24 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:14:24 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:14:25 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:14:25 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:14:27 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:14:28 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:14:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:14:28 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:14:28 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:14:28 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:14:28 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:14:28 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:14:28 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:14:28 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:14:28 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:14:28 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:14:28 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:14:28 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:14:28 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:14:28 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: Facture1688218INYON
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: Facture1688218INYON
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: SI NYON
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE Services Industriels de Terre-Sainte et Environs
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:340 - Montant TTC Swiss utilisé: 12671.55
2025-08-19 17:14:28 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: d83a0105-92d4-4f65-87a1-4b3f850ef646
2025-08-19 17:14:28 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.36s
2025-08-19 17:14:28 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.37s
2025-08-19 17:14:28 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:14:28 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:14:28 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpgzl3bu7e.pdf
2025-08-19 17:14:28 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpgzl3bu7e.pdf
2025-08-19 17:14:28 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:14:28 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:14:29 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:14:29 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:14:30 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:14:31 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:14:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:14:31 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:14:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:14:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:14:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:14:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:14:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:14:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: client
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: client
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: YAPI Electromécanique SA
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE Services Industriels de Terre-Sainte et Environs
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:323 - Montant HT LLM utilisé: -141.5609
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:325 - TVA LLM utilisée: 141.75
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:327 - Montant TTC LLM utilisé: 0.1891
2025-08-19 17:14:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: a16d91c0-efc1-462b-8aa4-7e36b0e87e5a
2025-08-19 17:14:31 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.07s
2025-08-19 17:14:31 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.09s
2025-08-19 17:14:31 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:14:31 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:14:31 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp4mchrucb.pdf
2025-08-19 17:14:31 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp4mchrucb.pdf
2025-08-19 17:14:32 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:14:32 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:14:32 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:14:32 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:14:34 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:529 - InvoiceData complet construit sans valeurs null
2025-08-19 17:14:35 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:14:35 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:14:35 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:14:35 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:14:35 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:14:35 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:14:35 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:14:35 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: CHE-106
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: CHE-106
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: STS Soudure - Tuyauterie - Service
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE Services Industriels de Terre-Sainte et Environs
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:325 - TVA LLM utilisée: 8.1
2025-08-19 17:14:35 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 2e491228-8f86-47d4-87d9-c91af19b9825
2025-08-19 17:14:35 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.08s
2025-08-19 17:14:35 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.10s
2025-08-19 17:15:08 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:15:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:15:09 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:15:09 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:15:09 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:15:09 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:15:09 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:15:23 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:15:23 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:15:23 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:15:23 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:15:23 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpancyper_.pdf
2025-08-19 17:15:23 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpancyper_.pdf
2025-08-19 17:15:23 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:15:23 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:15:24 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:15:24 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:15:26 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:15:26 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:15:26 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:15:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:15:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:15:26 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:15:26 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:15:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:15:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:15:26 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: defacture
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: defacture
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:323 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:325 - TVA LLM utilisée: 136.35
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:327 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:15:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: d4441b24-baa1-46f7-b0aa-adc7d6121bc3
2025-08-19 17:15:26 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.65s
2025-08-19 17:15:26 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.66s
2025-08-19 17:15:26 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:15:26 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:15:26 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpr7d5b6ti.pdf
2025-08-19 17:15:26 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpr7d5b6ti.pdf
2025-08-19 17:15:27 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:15:27 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:15:27 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:15:27 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:15:30 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:15:31 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:15:31 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:15:31 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:15:31 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:15:31 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:15:31 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:15:31 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:15:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:15:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:15:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:15:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:15:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:15:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:15:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:15:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: Facture1688218INYON
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: Facture1688218INYON
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: SI NYON
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:340 - Montant TTC Swiss utilisé: 12671.55
2025-08-19 17:15:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 1d79e021-7a62-422a-b658-f858b3454172
2025-08-19 17:15:31 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.74s
2025-08-19 17:15:31 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.75s
2025-08-19 17:15:31 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:15:31 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:15:31 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpczdixzgn.pdf
2025-08-19 17:15:31 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpczdixzgn.pdf
2025-08-19 17:15:32 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:15:32 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:15:32 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:15:32 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:15:34 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:15:34 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:15:34 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:15:34 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:15:34 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:15:34 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:15:34 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:15:34 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:15:34 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:15:34 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: client
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: client
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: YAPI Electromécanique SA
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:323 - Montant HT LLM utilisé: -141.5609
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:325 - TVA LLM utilisée: 141.75
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:327 - Montant TTC LLM utilisé: 0.1891
2025-08-19 17:15:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 36bb8d91-de98-49ea-9705-66748903d916
2025-08-19 17:15:34 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.05s
2025-08-19 17:15:34 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.07s
2025-08-19 17:15:34 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:15:34 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:15:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpb1l2q02p.pdf
2025-08-19 17:15:34 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpb1l2q02p.pdf
2025-08-19 17:15:35 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:15:35 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:15:35 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:15:35 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:15:37 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:15:38 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:15:38 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:15:38 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:15:38 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:15:38 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:15:38 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:15:38 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:15:38 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:_extract_invoice_number:88 - Numéro de facture LLM extrait: CHE-106
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:242 - Numéro de facture LLM utilisé: CHE-106
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:_extract_invoice_date:103 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:271 - Fournisseur LLM utilisé: STS Soudure - Tuyauterie - Service
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:_extract_company_enhanced:286 - Société LLM utilisée: SITSE
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:325 - TVA LLM utilisée: 8.1
2025-08-19 17:15:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:78 - DTO Invoice créé avec succès - ID: 81552d82-2d75-49af-9e96-77f21eccd30e
2025-08-19 17:15:38 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.17s
2025-08-19 17:15:38 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.18s
2025-08-19 17:16:16 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:16:18 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:16:18 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:16:18 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:16:18 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:16:18 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:16:18 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:16:34 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:16:34 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:16:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpw5ctxy7_.pdf
2025-08-19 17:16:34 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpw5ctxy7_.pdf
2025-08-19 17:16:34 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:16:34 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:16:35 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:16:35 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:16:37 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:16:37 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:16:37 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:16:37 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:16:37 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:16:37 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:16:37 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:16:37 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:16:37 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:16:37 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: defacture
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: defacture
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: defacture
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 59e96501-c5a4-4b9f-af4e-4d5af929b5be
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: None
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: None
2025-08-19 17:16:37 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: None
2025-08-19 17:16:37 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.81s
2025-08-19 17:16:37 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.82s
2025-08-19 17:17:01 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:17:03 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:17:03 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:17:03 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:17:03 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:17:03 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:17:03 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:17:21 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:17:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:17:22 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:17:22 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:17:23 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:17:23 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:17:23 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:17:33 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:17:33 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:17:33 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu0qaz16k.pdf
2025-08-19 17:17:33 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu0qaz16k.pdf
2025-08-19 17:17:33 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:17:33 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:17:33 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:17:33 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:17:35 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:17:36 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:17:36 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:17:36 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:17:36 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:17:36 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:17:36 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:17:36 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:17:36 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:17:36 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: defacture
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: defacture
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: defacture
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 15e9b63a-7b29-47eb-8091-9770e2cc733f
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: defacture
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:17:36 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:17:36 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.63s
2025-08-19 17:17:36 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.65s
2025-08-19 17:17:50 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:17:50 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:17:50 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:17:50 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:17:50 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpukuuxnq1.pdf
2025-08-19 17:17:50 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpukuuxnq1.pdf
2025-08-19 17:17:51 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:17:51 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:17:51 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:17:51 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:17:53 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:17:54 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:17:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:17:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:17:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:17:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:17:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:17:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:17:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:17:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: defacture
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: defacture
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: defacture
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: bf5c7481-bbbc-462f-8be2-14fb8c5f40d1
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: defacture
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:17:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:17:54 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.91s
2025-08-19 17:17:54 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.92s
2025-08-19 17:17:54 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:17:54 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:17:54 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpo66imz_8.pdf
2025-08-19 17:17:54 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpo66imz_8.pdf
2025-08-19 17:17:54 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:17:54 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:17:55 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:17:55 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:17:58 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:17:59 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:17:59 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: Facture1688218INYON
2025-08-19 17:17:59 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:17:59 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:17:59 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:17:59 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:17:59 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:17:59 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:17:59 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:17:59 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:17:59 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:17:59 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:17:59 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:17:59 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:17:59 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: Facture1688218INYON
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: Facture1688218INYON
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: SI NYON
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:352 - Montant TTC Swiss utilisé: 12671.55
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: Facture1688218INYON
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-01-31
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: SI NYON
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 12671.55
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 0.00
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 07bf6cc4-e448-4b0e-8b0d-52a80629a00d
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: Facture1688218INYON
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:17:59 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: SI NYON
2025-08-19 17:17:59 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.64s
2025-08-19 17:17:59 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.65s
2025-08-19 17:17:59 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:17:59 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:17:59 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp83nh4c38.pdf
2025-08-19 17:17:59 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp83nh4c38.pdf
2025-08-19 17:17:59 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:17:59 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:18:00 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:18:00 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:18:01 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: client
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 141.75
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:18:02 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:18:02 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:18:02 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:18:02 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:18:02 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:18:02 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:18:02 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:18:02 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:18:02 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: client
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: client
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: YAPI Electromécanique SA
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: -141.5609
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 141.75
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 0.1891
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: client
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-10
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: YAPI Electromécanique SA
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.1891
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 141.75
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 4982cd02-4d8f-409a-ac3c-0a88ea8cd463
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: client
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:18:02 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: YAPI Electromécanique SA
2025-08-19 17:18:02 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.12s
2025-08-19 17:18:02 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.13s
2025-08-19 17:18:02 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:18:02 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:18:02 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpcd_h2sso.pdf
2025-08-19 17:18:02 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpcd_h2sso.pdf
2025-08-19 17:18:02 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:18:02 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:18:03 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:18:03 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:18:05 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: CHE-106
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 8.1
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 2
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:332 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:18:06 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:18:06 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:18:06 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:18:06 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:18:06 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:18:06 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:18:06 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:18:06 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: CHE-106
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: CHE-106
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: STS Soudure - Tuyauterie - Service
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 8.1
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: CHE-106
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2024-04-26
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.00
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 8.1
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: e637cb0a-498f-4bf4-87c9-324118414bf0
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: CHE-106
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:18:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:18:06 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.12s
2025-08-19 17:18:06 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.13s
2025-08-19 17:18:56 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:18:56 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:18:56 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpb39vsu7r.pdf
2025-08-19 17:18:56 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpb39vsu7r.pdf
2025-08-19 17:18:56 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:18:56 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:18:57 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:18:57 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:18:59 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:19:00 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:19:00 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:19:00 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:19:00 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:19:00 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:19:00 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:19:00 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:19:00 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:19:00 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: defacture
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: defacture
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: defacture
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 4665580c-5d64-4b12-a9ad-42fa4db90d81
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: defacture
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:19:00 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:19:00 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.79s
2025-08-19 17:19:00 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.80s
2025-08-19 17:19:07 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:19:07 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:19:07 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp_xrt7ico.pdf
2025-08-19 17:19:07 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp_xrt7ico.pdf
2025-08-19 17:19:07 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:19:07 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:19:08 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:19:08 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:19:10 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:162 - Numéro de facture LLM trouvé: defacture
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant tva trouvé: 136.35
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:252 - Montant amount_generic trouvé: 295
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:296 - Société trouvée par ERP: SITSE
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:324 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:530 - InvoiceData complet construit sans valeurs null
2025-08-19 17:19:11 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:19:11 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:19:11 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:19:11 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:19:11 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:19:11 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:19:11 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:19:11 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:19:11 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: defacture
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: defacture
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: defacture
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: b3ed39c5-28eb-4a0a-bc99-234f2d833820
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: defacture
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:19:11 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:19:11 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.93s
2025-08-19 17:19:11 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.94s
2025-08-19 17:21:37 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:21:38 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:21:38 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:21:38 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:21:38 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:21:38 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:21:38 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:21:46 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:21:46 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:21:46 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:21:46 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:21:46 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpi8lpg6z2.pdf
2025-08-19 17:21:46 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpi8lpg6z2.pdf
2025-08-19 17:21:46 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:21:46 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:21:47 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:21:47 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:21:49 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:160 - N° de facture trouvé: 110009850987ROMANDE1
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant tva trouvé: 136.35
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant amount_generic trouvé: 295
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:342 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:21:50 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:21:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:21:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:21:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:21:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:21:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:21:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:21:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:21:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 110009850987ROMANDE1
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 110009850987ROMANDE1
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 110009850987ROMANDE1
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 922f66b1-5592-4e8b-8cb7-3da7b5c92fe2
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 110009850987ROMANDE1
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:21:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:21:50 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.56s
2025-08-19 17:21:50 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.58s
2025-08-19 17:21:50 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:21:50 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:21:50 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu5fr2gbb.pdf
2025-08-19 17:21:50 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpu5fr2gbb.pdf
2025-08-19 17:21:50 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:21:50 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:21:51 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:21:51 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:21:53 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:21:54 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:21:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:160 - N° de facture trouvé: 1688218INYON
2025-08-19 17:21:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:21:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:21:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:350 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:21:54 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:21:54 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:21:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:21:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:21:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:21:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:21:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:21:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:21:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:21:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 1688218INYON
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 1688218INYON
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: SI NYON
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:352 - Montant TTC Swiss utilisé: 12671.55
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 1688218INYON
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-01-31
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: SI NYON
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 12671.55
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 0.00
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 54f1db7d-7872-4fa8-830b-2af01c7989f8
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 1688218INYON
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:21:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: SI NYON
2025-08-19 17:21:54 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.39s
2025-08-19 17:21:54 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.40s
2025-08-19 17:21:54 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:21:54 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:21:54 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpnof0bndl.pdf
2025-08-19 17:21:54 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpnof0bndl.pdf
2025-08-19 17:21:54 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:21:54 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:21:55 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:21:55 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:21:56 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:178 - Numéro de facture alternatif trouvé: No35
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant tva trouvé: 141.75
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:350 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:21:57 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:21:57 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:21:57 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:21:57 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:21:57 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:21:57 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:21:57 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:21:57 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:21:57 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: No35
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: No35
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: YAPI Electromécanique SA
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: -141.5609
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 141.75
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 0.1891
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: No35
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-10
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: YAPI Electromécanique SA
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.1891
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 141.75
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: d1bb8d49-3e8f-4a9d-b9dd-061f7fa5d512
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: No35
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:21:57 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: YAPI Electromécanique SA
2025-08-19 17:21:57 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.04s
2025-08-19 17:21:57 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.05s
2025-08-19 17:21:57 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:21:57 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:21:57 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpo0y1ugn_.pdf
2025-08-19 17:21:57 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpo0y1ugn_.pdf
2025-08-19 17:21:57 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:21:58 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:21:58 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:21:58 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:22:00 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:160 - N° de facture trouvé: 24044Penthaz
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant tva trouvé: 8.1
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant amount_generic trouvé: 2
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:350 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:22:01 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:22:01 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:22:01 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:22:01 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:22:01 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:22:01 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:22:01 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:22:01 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 24044Penthaz
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 24044Penthaz
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: STS Soudure - Tuyauterie - Service
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 8.1
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 24044Penthaz
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2024-04-26
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.00
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 8.1
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 03fcf76d-41cf-4a38-b934-3ef81f0cf943
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 24044Penthaz
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:22:01 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:22:01 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.10s
2025-08-19 17:22:01 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.12s
2025-08-19 17:23:02 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:23:02 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.01s
2025-08-19 17:23:02 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:23:02 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:23:02 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpwygpdsnn.pdf
2025-08-19 17:23:02 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpwygpdsnn.pdf
2025-08-19 17:23:02 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:23:02 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:23:03 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:23:03 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:23:05 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:160 - N° de facture trouvé: 110009850987ROMANDE1
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant tva trouvé: 136.35
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant amount_generic trouvé: 295
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:342 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:23:06 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:23:06 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:23:06 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:23:06 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:23:06 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:23:06 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:23:06 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:23:06 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:23:06 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 110009850987ROMANDE1
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 110009850987ROMANDE1
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 110009850987ROMANDE1
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 3debf8f5-8a1e-4991-a494-43df626eab45
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 110009850987ROMANDE1
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:23:06 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:23:06 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.00s
2025-08-19 17:23:06 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.01s
2025-08-19 17:23:06 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:23:06 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:23:06 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpn74h_6_j.pdf
2025-08-19 17:23:06 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpn74h_6_j.pdf
2025-08-19 17:23:06 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:23:06 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:23:07 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:23:07 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:23:09 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:23:10 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:23:10 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:160 - N° de facture trouvé: 1688218INYON
2025-08-19 17:23:10 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:23:10 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:23:10 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:350 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:23:10 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:23:10 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:23:10 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:23:10 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:23:10 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:23:10 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:23:10 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:23:10 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:23:10 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:23:10 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 1688218INYON
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 1688218INYON
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: SI NYON
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:352 - Montant TTC Swiss utilisé: 12671.55
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 1688218INYON
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-01-31
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: SI NYON
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 12671.55
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 0.00
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 026ce8bd-9c2d-463b-bb0a-04f8040514cc
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 1688218INYON
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:23:10 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: SI NYON
2025-08-19 17:23:10 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.62s
2025-08-19 17:23:10 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.62s
2025-08-19 17:23:10 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:23:10 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:23:10 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp3r9v0rit.pdf
2025-08-19 17:23:10 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp3r9v0rit.pdf
2025-08-19 17:23:11 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:23:11 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:23:11 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:23:11 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:23:13 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:178 - Numéro de facture alternatif trouvé: No35
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant tva trouvé: 141.75
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:350 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:23:13 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:23:13 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:23:13 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:23:13 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:23:13 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:23:13 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:23:13 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:23:13 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:23:13 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: No35
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: No35
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: YAPI Electromécanique SA
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: -141.5609
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 141.75
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 0.1891
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: No35
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-10
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: YAPI Electromécanique SA
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.1891
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 141.75
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 1a95e2fa-2e2c-45c6-bf79-7606c0886708
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: No35
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:23:13 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: YAPI Electromécanique SA
2025-08-19 17:23:13 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 2.99s
2025-08-19 17:23:13 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.00s
2025-08-19 17:23:13 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:23:13 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:23:13 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpx8yaye0m.pdf
2025-08-19 17:23:13 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpx8yaye0m.pdf
2025-08-19 17:23:14 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:23:14 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:23:14 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:23:14 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:23:16 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:160 - N° de facture trouvé: 24044Penthaz
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant tva trouvé: 8.1
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:270 - Montant amount_generic trouvé: 2
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:314 - Société trouvée par ERP: SITSE
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:350 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:548 - InvoiceData complet construit sans valeurs null
2025-08-19 17:23:17 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:23:17 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:23:17 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:23:17 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:23:18 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:23:18 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:23:18 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:23:18 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:23:18 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 24044Penthaz
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 24044Penthaz
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: STS Soudure - Tuyauterie - Service
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 8.1
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 24044Penthaz
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2024-04-26
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.00
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 8.1
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 7e62a50d-6cba-4e77-b859-c0559aa9660c
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 24044Penthaz
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:23:18 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:23:18 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.11s
2025-08-19 17:23:18 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.12s
2025-08-19 17:23:48 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:23:49 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:23:49 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:23:49 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:23:49 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:23:49 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:23:49 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:24:26 | INFO     | src.main:lifespan:31 - Arrêt de l'application OCR Factures
2025-08-19 17:24:28 | INFO     | src.ocr.ocr_engine:_validate_tesseract:51 - Chemin Tesseract configuré: /opt/homebrew/bin/tesseract
2025-08-19 17:24:28 | INFO     | src.ocr.ocr_engine:_validate_tesseract:58 - Tesseract trouvé: tesseract 5.5.1
2025-08-19 17:24:28 | INFO     | src.extraction.llm_enhanced_extractor:__init__:31 - LLM Extractor initialisé avec 1 sociétés et 5 fournisseurs
2025-08-19 17:24:28 | INFO     | src.main:lifespan:24 - Démarrage de l'application OCR Factures
2025-08-19 17:24:28 | INFO     | src.main:lifespan:25 - Version: 1.0.0
2025-08-19 17:24:28 | INFO     | src.main:lifespan:26 - Mode debug: False
2025-08-19 17:24:38 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:24:38 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:24:38 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:24:38 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:24:38 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp30pk34fy.pdf
2025-08-19 17:24:38 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp30pk34fy.pdf
2025-08-19 17:24:39 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:24:39 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:24:39 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:24:39 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:24:41 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': 110009850987ROMANDE1
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant tva trouvé: 136.35
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant amount_generic trouvé: 295
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:346 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:24:42 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:24:42 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:24:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:24:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:24:42 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:24:42 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:24:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:24:42 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:24:42 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 110009850987ROMANDE1
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 110009850987ROMANDE1
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 110009850987ROMANDE1
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 20a2d867-5414-4784-b46f-f76c20b834f1
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 110009850987ROMANDE1
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:24:42 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:24:42 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.89s
2025-08-19 17:24:42 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.90s
2025-08-19 17:24:42 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:24:42 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:24:42 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphlpsv7ce.pdf
2025-08-19 17:24:42 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphlpsv7ce.pdf
2025-08-19 17:24:43 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:24:43 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:24:43 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:24:43 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:24:46 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:24:47 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:24:47 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': 1688218INYON
2025-08-19 17:24:47 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:24:47 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:24:47 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:354 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:24:47 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:24:47 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:24:47 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:24:47 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:24:47 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:24:47 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:24:47 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:24:47 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:24:47 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:24:47 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 1688218INYON
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 1688218INYON
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: SI NYON
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:352 - Montant TTC Swiss utilisé: 12671.55
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 1688218INYON
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-01-31
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: SI NYON
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 12671.55
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 0.00
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 2b458d36-8cbd-4670-b794-1f0901ed078c
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 1688218INYON
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:24:47 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: SI NYON
2025-08-19 17:24:47 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.64s
2025-08-19 17:24:47 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.65s
2025-08-19 17:24:47 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:24:47 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:24:47 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpgwnqkqa4.pdf
2025-08-19 17:24:47 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpgwnqkqa4.pdf
2025-08-19 17:24:47 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:24:47 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:24:48 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:24:48 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:24:49 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': etsansd
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant tva trouvé: 141.75
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:354 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:24:50 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:24:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:24:50 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:24:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:24:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:24:50 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:24:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:24:50 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:24:50 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: etsansd
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: etsansd
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: YAPI Electromécanique SA
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: -141.5609
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 141.75
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 0.1891
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: etsansd
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-10
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: YAPI Electromécanique SA
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.1891
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 141.75
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 01a2ae24-a176-4895-b564-f403a3ea56b2
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: etsansd
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:24:50 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: YAPI Electromécanique SA
2025-08-19 17:24:50 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.02s
2025-08-19 17:24:50 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.04s
2025-08-19 17:24:50 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:24:50 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:24:50 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpleqfssqh.pdf
2025-08-19 17:24:50 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpleqfssqh.pdf
2025-08-19 17:24:50 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:24:50 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:24:51 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:24:51 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:24:53 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': 24044Penthaz
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant tva trouvé: 8.1
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant amount_generic trouvé: 2
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:354 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:24:54 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:24:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:24:54 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:24:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:24:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:24:54 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:24:54 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:24:54 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 24044Penthaz
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 24044Penthaz
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: STS Soudure - Tuyauterie - Service
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 8.1
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 24044Penthaz
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2024-04-26
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.00
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 8.1
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: c999c20a-442c-438e-b3e5-7dd9bc8b09b6
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 24044Penthaz
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:24:54 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:24:54 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.07s
2025-08-19 17:24:54 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.08s
2025-08-19 17:25:22 | INFO     | src.main:log_requests:124 - Requête: GET http://localhost:8000/api/v1/health
2025-08-19 17:25:22 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 0.00s
2025-08-19 17:25:22 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:25:22 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163636929.pdf
2025-08-19 17:25:22 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpl7phmvdi.pdf
2025-08-19 17:25:22 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpl7phmvdi.pdf
2025-08-19 17:25:23 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:25:23 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:25:23 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:25:23 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:25:25 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.73
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': 110009850987ROMANDE1
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant total_ttc trouvé: 1858.73
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant tva trouvé: 136.35
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant amount_generic trouvé: 295
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:346 - Fournisseur trouvé: Romande Energie SA
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:25:26 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:25:26 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:25:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 110009850987
2025-08-19 17:25:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-17
2025-08-19 17:25:26 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:25:26 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:25:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:25:26 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 1858.75
2025-08-19 17:25:26 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '110009850987', 'invoice_date': datetime.date(2025, 2, 17), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('1858.75'), 'total_ht': None, 'tva': None}}
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 110009850987ROMANDE1
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 110009850987ROMANDE1
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-17
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: Romande Energie SA
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: 1722.38
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 136.35
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 1858.73
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 110009850987ROMANDE1
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-17
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: Romande Energie SA
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 1858.73
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 136.35
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: b24ee51b-4ef9-48c9-9b62-3bf3b4291944
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 110009850987ROMANDE1
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:25:26 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: Romande Energie SA
2025-08-19 17:25:26 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.89s
2025-08-19 17:25:26 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.90s
2025-08-19 17:25:26 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:25:26 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163709949.pdf
2025-08-19 17:25:26 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8mi0_u57.pdf
2025-08-19 17:25:26 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmp8mi0_u57.pdf
2025-08-19 17:25:27 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:25:27 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:25:27 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:25:27 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:25:30 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.66
2025-08-19 17:25:31 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:25:31 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': 1688218INYON
2025-08-19 17:25:31 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant amount_generic trouvé: 12671.55
2025-08-19 17:25:31 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:25:31 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:354 - Fournisseur trouvé par mot-clé: SI NYON
2025-08-19 17:25:31 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:25:31 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:25:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:25:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_invoice_number:103 - Numéro de facture trouvé: 1688218
2025-08-19 17:25:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-01-31
2025-08-19 17:25:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:25:31 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:25:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:25:31 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - total_ttc trouvé: 12671.55
2025-08-19 17:25:31 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': '1688218', 'invoice_date': datetime.date(2025, 1, 31), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': Decimal('12671.55'), 'total_ht': None, 'tva': None}}
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 1688218INYON
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 1688218INYON
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-01-31
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: SI NYON
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:352 - Montant TTC Swiss utilisé: 12671.55
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 1688218INYON
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-01-31
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: SI NYON
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 12671.55
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 0.00
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 5a063e32-2177-4b02-9a5d-47b941927cd5
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 1688218INYON
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:25:31 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: SI NYON
2025-08-19 17:25:31 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.60s
2025-08-19 17:25:31 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.61s
2025-08-19 17:25:31 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:25:31 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304163810596.pdf
2025-08-19 17:25:31 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpzx_9ufhl.pdf
2025-08-19 17:25:31 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmpzx_9ufhl.pdf
2025-08-19 17:25:31 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:25:31 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:25:32 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:25:32 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:25:33 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.80
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': etsansd
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant total_ttc trouvé: 0.1891
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant tva trouvé: 141.75
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:354 - Fournisseur trouvé par mot-clé: YAPI Electromécanique SA
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:25:34 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:25:34 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:25:34 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:25:34 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2025-02-11
2025-08-19 17:25:34 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:25:34 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:25:34 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: CHF
2025-08-19 17:25:34 | INFO     | src.extraction.swiss_invoice_extractor:_extract_amounts:245 - tva trouvé: 0
2025-08-19 17:25:34 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2025, 2, 11), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'CHF', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': Decimal('0')}}
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: etsansd
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: etsansd
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2025-02-10
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: YAPI Electromécanique SA
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:335 - Montant HT LLM utilisé: -141.5609
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 141.75
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:339 - Montant TTC LLM utilisé: 0.1891
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: etsansd
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2025-02-10
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: YAPI Electromécanique SA
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.1891
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 141.75
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 402a6a36-7a7a-4ba3-a241-7d877846c9f9
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: etsansd
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:25:34 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: YAPI Electromécanique SA
2025-08-19 17:25:34 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 3.11s
2025-08-19 17:25:34 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 3.14s
2025-08-19 17:25:34 | INFO     | src.main:log_requests:124 - Requête: POST http://localhost:8000/api/v1/process-invoice
2025-08-19 17:25:34 | INFO     | src.api.routes:process_invoice:61 - Début du traitement de la facture: 20250304164049944.pdf
2025-08-19 17:25:34 | INFO     | src.preprocessing.enhanced_image_processor:process_file:147 - Traitement du fichier: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphm68k6nt.pdf
2025-08-19 17:25:34 | INFO     | src.processors.pdf_processor:process:50 - Conversion PDF en cours: /Users/rado.herilalao.sopra-steria/Library/CloudStorage/OneDrive-PMU/Documents/OCR/ocr_factures/data/temp/tmphm68k6nt.pdf
2025-08-19 17:25:34 | INFO     | src.processors.pdf_processor:process:66 - PDF converti avec succès - Taille: (3508, 2480, 3)
2025-08-19 17:25:34 | WARNING  | src.preprocessing.enhanced_image_processor:correct_skew:48 - Impossible de corriger l'inclinaison: not enough values to unpack (expected 2, got 1)
2025-08-19 17:25:35 | INFO     | src.preprocessing.enhanced_image_processor:process_file:158 - Préprocessing terminé avec succès
2025-08-19 17:25:35 | INFO     | src.ocr.ocr_engine:extract_text:76 - Extraction OCR en cours (langue: fra)
2025-08-19 17:25:37 | INFO     | src.ocr.ocr_engine:extract_text:117 - OCR terminé - Confiance: 0.74
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:47 - Début de l'extraction LLM intelligente
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_invoice_number:164 - N° de facture trouvé avec 'facture': 24044Penthaz
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant tva trouvé: 8.1
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:_llm_extract_amounts:274 - Montant amount_generic trouvé: 2
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:_find_company_in_text:318 - Société trouvée par ERP: SITSE
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:_find_supplier_in_text:354 - Fournisseur trouvé par mot-clé: STS Soudure - Tuyauterie - Service
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:_build_complete_invoice_data:552 - InvoiceData complet construit sans valeurs null
2025-08-19 17:25:38 | INFO     | src.extraction.llm_enhanced_extractor:extract_invoice_data_with_llm:64 - Extraction LLM terminée avec succès
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:31 - Création du DTO Invoice à partir des données extraites avec BDD
2025-08-19 17:25:38 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:64 - Extraction des données de facture avec base de données
2025-08-19 17:25:38 | WARNING  | src.extraction.swiss_invoice_extractor:_extract_invoice_number:106 - Numéro de facture non trouvé
2025-08-19 17:25:38 | INFO     | src.extraction.swiss_invoice_extractor:_extract_date:122 - Date de facture trouvée: 2024-04-26
2025-08-19 17:25:38 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_company_from_db:169 - Erreur lors de la recherche de société: (psycopg2.errors.UndefinedColumn) column "company_erp_code" does not exist
LINE 2:                 SELECT company_erp_code, company_name 
                               ^

[SQL: 
                SELECT company_erp_code, company_name 
                FROM company 
                WHERE company_erp_code IS NOT NULL
            ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-19 17:25:38 | ERROR    | src.extraction.swiss_invoice_extractor:_extract_supplier_from_db:209 - Erreur lors de la recherche de fournisseur: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: 
                SELECT DISTINCT supplier_name 
                FROM supplier 
                WHERE supplier_name IS NOT NULL 
                AND LENGTH(supplier_name) > 3
            ]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-08-19 17:25:38 | INFO     | src.extraction.swiss_invoice_extractor:_extract_currency:218 - Devise trouvée: EUR
2025-08-19 17:25:38 | INFO     | src.extraction.swiss_invoice_extractor:extract_invoice_data_with_db:82 - Données extraites: {'invoice_number': None, 'invoice_date': datetime.date(2024, 4, 26), 'company_erp_code': None, 'supplier_name': None, 'currency_code': 'EUR', 'amounts': {'total_ttc': None, 'total_ht': None, 'tva': None}}
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:_extract_invoice_number:100 - Numéro de facture LLM extrait: 24044Penthaz
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:_extract_invoice_number_enhanced:254 - Numéro de facture LLM utilisé: 24044Penthaz
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:_extract_invoice_date:115 - Date de facture LLM extraite: 2024-04-26
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:_extract_supplier_name_enhanced:283 - Fournisseur LLM utilisé: STS Soudure - Tuyauterie - Service
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:_extract_company_enhanced:298 - Société LLM utilisée: SITSE
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:_extract_amounts_enhanced:337 - TVA LLM utilisée: 8.1
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:60 - Création DTO avec les valeurs:
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:61 -   - invoice_number: 24044Penthaz
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:62 -   - invoice_date: 2024-04-26
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:63 -   - company_erp_code: SITSE
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:64 -   - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:65 -   - including_taxes: 0.00
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:66 -   - vat: 8.1
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:67 -   - currency_code: CHF
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:87 - DTO Invoice créé avec succès - ID: 53879afb-2ff5-4e4b-a43a-d05be04fca5b
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:88 - DTO après création - invoice_number: 24044Penthaz
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:89 - DTO après création - company_erp_code: SITSE
2025-08-19 17:25:38 | INFO     | src.services.invoice_service:create_invoice_from_extracted_data:90 - DTO après création - supplier_name: STS Soudure - Tuyauterie - Service
2025-08-19 17:25:38 | INFO     | src.api.routes:process_invoice:112 - Traitement terminé en 4.27s
2025-08-19 17:25:38 | INFO     | src.main:log_requests:131 - Réponse: 200 - Temps de traitement: 4.28s
